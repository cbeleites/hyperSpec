<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Package "hyperSpec" • hyperSpec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to Package " hyperspec>
<meta property="og:description" content="Introduction: hyperSpec's main manual.">
<meta name="robots" content="noindex">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hyperSpec</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.99-20200615</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-book"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Documentation for version of package:</li>
    <li>
      <a href="https://cbeleites.github.io/hyperSpec/">Released</a>
    </li>
    <li>
      <a href="https://cbeleites.github.io/hyperSpec/dev/">In-development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hyperSpec.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fileio.html">Import and Export Files with Spectra</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting Functions in "hyperSpec"</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Fitting Baselines to Spectra</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/index.html">More...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/cbeleites/hyperSpec/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hyperSpec_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Package “hyperSpec”</h1>
            <h3 class="subtitle">The Main Manual of Package “hyperSpec”</h3>
                        <h4 class="author">Claudia Beleites<sup>1,2,3,4,5</sup>, Vilmantas Gegzna, Bryan A. Hanson</h4>
            <address class="author_afil">
      <ol style="list-style-type: decimal">
<li>DIA Raman Spectroscopy Group, University of Trieste/Italy (2005–2008)</li>
      <li>Spectroscopy <span class="math inline">\(\cdot\)</span> Imaging, IPHT, Jena/Germany (2008–2017)</li>
      <li>ÖPV, JKI, Berlin/Germany (2017–2019)</li>
      <li>Arbeitskreis Lebensmittelmikrobiologie und Biotechnologie, Hamburg University, Hamburg/Germany (2019 – 2020)</li>
      <li>Chemometric Consulting and Chemometrix GmbH, Wölfersheim/Germany (since 2016)</li>
      </ol>
<br><a class="author_email" href="mailto:#"></a><a href="mailto:chemometrie@beleites.de" class="email">chemometrie@beleites.de</a>
      </address>
                  
            <h4 class="date">2020-07-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cbeleites/hyperSpec/blob/master/../vignettes/hyperSpec.Rmd"><code>../vignettes/hyperSpec.Rmd</code></a></small>
      <div class="hidden name"><code>hyperSpec.Rmd</code></div>

    </div>

    
    
<!-- \tableofcontents -->
<div id="things-to-know-about-hyperspec" class="section level1">
<h1 class="hasAnchor">
<a href="#things-to-know-about-hyperspec" class="anchor"></a><span class="header-section-number">1</span> Things to Know About <strong><em>hyperSpec</em></strong>
</h1>
<p>Package <strong>hyperSpec</strong> is a <code>R</code> package that allows convenient handling of  hyperspectral data sets, i.e., data sets combining spectra with further data on a per-spectrum basis.
The spectra can be anything that is recorded over a common discretized axis.
This vignette gives an introduction on basic working techniques using the <code>R</code> package package <strong>hyperSpec</strong>.
This is done mostly from a spectroscopic point of view: rather than going through the functions provided by package <strong>hyperSpec</strong>, it is organized by spectroscopic tasks.</p>
<div id="terms-notations-used-here" class="section level2">
<h2 class="hasAnchor">
<a href="#terms-notations-used-here" class="anchor"></a><span class="header-section-number">1.1</span> Terms &amp; Notations Used Here</h2>
<p>Throughout the documentation of the package, the following terms are used:</p>
<dl>
<dt>
<strong>wavelength</strong> </dt>
<dd>spectral abscissa
frequency, typical units are wavenumbers, chemical shift, Raman shift, <span class="math inline">\(\frac{m}{z}\)</span>, etc.
</dd>
<dt>
<strong>intensity</strong> </dt>
<dd>spectral ordinate
transmission, absorbance, <span class="math inline">\(\frac{e^{-}}{s}\)</span>, intensity, etc.
</dd>
<dt>
<strong>extra data</strong> </dt>
<dd>further information/data belonging to each spectrum such as
spatial information (spectral images, maps, or profiles), temporal information (kinetics, time series), concentrations (calibration series), class membership information, etc. Class <code>hyperSpec</code> object may contain arbitrary numbers of extra data columns.
</dd>
</dl>
<p>In R, slots of an S4 class are accessed by the <code class="sourceCode r"><span class="op">@</span></code> operator.
In this vignette, the notation <code class="sourceCode r"><span class="op">@</span>xxx</code> will thus mean <em>“slot xxx of an object”</em>.
Likewise, named elements of a <code>list</code> and columns of a <code>data.frame</code> are accessed by the  <code class="sourceCode r"><span class="op">$</span></code> operator, and <code class="sourceCode r"><span class="op">$</span>xxx</code> will be used for <em>“column xxx”</em>, and as an abbreviation for <em>“column xxx of the <code>data.frame</code> in slot data of the object”</em> (the structure of <code>hyperSpec</code> objects is discussed in section <a href="#sec:structure-chy">1.2</a>).</p>
</div>
<div id="sec:structure-chy" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:structure-chy" class="anchor"></a><span class="header-section-number">1.2</span> The Structure of <strong><em>hyperSpec</em></strong> Objects</h2>
<p><code>hyperSpec</code> objects are defined using an S4 class. It contains the following slots:</p>
<ul>
<li>
<strong><code class="sourceCode r"><span class="op">@</span>wavelength</code></strong> containing a numeric vector with the wavelength axis of the spectra.</li>
<li>
<strong><code class="sourceCode r"><span class="op">@</span>data</code></strong> a <code>data.frame</code> with the spectra and all further information belonging to the spectra.</li>
<li>
<strong><code class="sourceCode r"><span class="op">@</span>label</code></strong> a list with appropriate labels (particularly for axis annotations).</li>
</ul>
<p>Most of the data is stored in <code class="sourceCode r"><span class="op">@</span>data</code>. This <code>data.frame</code> has one special column, <code class="sourceCode r"><span class="op">$</span>spc</code>. This is the column that actually contains the spectra. The spectra are stored in a matrix inside this column, as illustrated in Figure <a href="#fig:structure">1.1</a>.
Even if there are no spectra, <code class="sourceCode r"><span class="op">$</span>spc</code> must still be present.
It is then a matrix with zero columns.</p>
<div class="figure" style="text-align: center">
<span id="fig:structure"></span>
<img src="intro--structure--hyperSpec--objects.png" alt="The structure of the data in a `hyperSpec` object.  In this example the 'extra data' are the `x`, `y` and `c` columns in `@data`." width="600"><p class="caption">
Figure 1.1: The structure of the data in a <code>hyperSpec</code> object. In this example the ‘extra data’ are the <code>x</code>, <code>y</code> and <code>c</code> columns in <code>@data</code>.
</p>
</div>
<p>Slot <code class="sourceCode r"><span class="op">@</span>label</code> contains an element for each of the columns in <code class="sourceCode r"><span class="op">@</span>data</code> plus one holding the label for the wavelength axis, <code>.wavelength</code>.
They are accessed by their names which must be the same for columns of <code class="sourceCode r"><span class="op">@</span>data</code> and the list elements.
The elements of the list may be anything suitable for axis annotations, i.e., they should be either character strings or expressions for “pretty” axis annotations (see, e.g., Figure <a href="#fig:loess-kl">7.8</a>).
To get familiar with expressions for axis annotation, see <code><a href="https://rdrr.io/r/grDevices/plotmath.html">?plotmath</a></code> and <code class="sourceCode r"><span class="kw">demo</span>(plotmath)</code>.</p>
</div>
<div id="data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#data-sets" class="anchor"></a><span class="header-section-number">1.3</span> Data Sets</h2>
<p>Package <strong>hyperSpec</strong> comes with several data sets:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><strong><code>chondro</code></strong></td>
<td align="left">
A Raman map of chondrocytes in cartilage.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>fauxCell</code></strong></td>
<td align="left">
A synthetic data set similar to <code>chondro</code>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>flu</code></strong></td>
<td align="left">
A set of fluorescence spectra of a calibration series.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>laser</code></strong></td>
<td align="left">
A time series of an unstable laser emission.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>paracetamol</code></strong></td>
<td align="left">
A Raman spectrum of paracetamol (acetaminophen) ranging
from 100 to 3200 cm<sup>-1</sup> with overlapping wavelength ranges.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>barbiturates</code></strong></td>
<td align="left">
GC-MS spectra with differing wavelength axes as a list of
5 <strong>hyperSpec</strong> objects.</td>
</tr>
</tbody>
</table>
<p>In this vignette, the data sets are used to illustrate appropriate procedures for different tasks and different spectra.
In addition, <code>chondro</code>, <code>laser</code> and <code>flue</code> are accompanied by their own vignettes showing sample work flows for the respective data type.</p>
<p>This document describes how to accomplish typical tasks in the analysis of spectra.
It does not give a complete reference on particular functions.
It is therefore recommended to look up the methods in the <code>R</code> help system using <code class="sourceCode r">?command</code>.</p>
</div>
<div id="options" class="section level2">
<h2 class="hasAnchor">
<a href="#options" class="anchor"></a><span class="header-section-number">1.4</span> Options</h2>
<p>


The global behaviour of package <strong>hyperSpec</strong> can be configured via options.
The values of the options are retrieved with <code class="sourceCode r"><span class="kw">hy.getOptions</span>()</code> and <code class="sourceCode r"><span class="kw">hy.getOption</span>()</code>, and changed with <code class="sourceCode r"><span class="kw">hy.setOptions</span>()</code>.
Table <a href="#tab:options">8.2</a> gives an overview of the options. You should not worry about these at the start of your exploration of <strong>hyperSpec</strong>.</p>
</div>
</div>
<div id="info-hyperspec-objs" class="section level1">
<h1 class="hasAnchor">
<a href="#info-hyperspec-objs" class="anchor"></a><span class="header-section-number">2</span> Obtaining Basic Information about <strong><em>hyperSpec</em></strong> Objects</h1>

<p>As usual, the <code class="sourceCode r"><span class="kw">print</span>()</code>, <code class="sourceCode r"><span class="kw">show</span>()</code> and <code class="sourceCode r"><span class="kw">summary</span>()</code> methods provide an overview of the object (only <code>print</code> is shown here):</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw">chondro</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    875 spectra</span>
<span class="co">#&gt;    5 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (875 rows x 5 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] -4.77 -4.77 ... 19.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -11.55 -10.55 ... 22.45 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] matrix matrix ... lacuna + NA</span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 501.82 500.46 ... 169.29</span>
</pre></div>

<p>The data set <code class="sourceCode r">chondro</code> consists of 875 spectra with 300 data points each, and 5 data columns: two for the spatial information, one factor with the results of a cluster analysis plus <code class="sourceCode r"><span class="op">$</span>spc</code>.
These details can be directly obtained by</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; [1] 875</span>
</pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="../reference/ncol,hyperSpec-method.html">nwl</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; [1] 300</span>
</pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; [1] 5</span>
</pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; nrow ncol  nwl </span>
<span class="co">#&gt;  875    5  300</span>
</pre></div>

<p>The names of the columns in <code class="sourceCode r"><span class="op">@</span>data</code> are accessed by <code class="sourceCode r"><span class="kw">colnames</span>()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="../reference/dimnames,hyperSpec-method.html">colnames</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; [1] "y"        "x"        "filename" "clusters" "spc"</span>
</pre></div>
<p>Likewise, <code class="sourceCode r"><span class="kw">rownames</span>()</code> returns the names assigned to the spectra, and <code class="sourceCode r"><span class="kw">dimnames</span>()</code> yields a list of these three vectors (including also the column names of <code class="sourceCode r"><span class="op">$</span>spc</code>).
The column names of the spectra matrix contain the wavelengths as character, while <code class="sourceCode r"><span class="kw">wl</span>()</code> (see section <a href="#sec:wavel-axis-conv">3.5.4</a>) yields the numeric vector of wavelengths.</p>

<p>Extra data column names and rownames of the object may be set by <code class="sourceCode r">colnames&lt;-</code> and <code class="sourceCode r">rownames&lt;-</code>, respectively.
Function <code class="sourceCode r">colnames&lt;-</code> renames the labels as well.</p>
</div>
<div id="sec:access-parts" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:access-parts" class="anchor"></a><span class="header-section-number">3</span> Accessing &amp; Manipulating <strong><em>hyperSpec</em></strong> Objects</h1>
<p>While the parts of the <code>hyperSpec</code> object can be accessed directly, it is good practice to use the functions provided by the package to handle the objects rather than accessing the slots directly.
This also ensures that proper (i.e. <em>valid</em>) objects are returned.
In some cases, however, direct access to the slots can considerably speed up calculations (see the appendicies).</p>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
<p>The main functions to retrieve the data of a <code class="sourceCode r">hyperSpec</code> object are <code>[]</code> and <code>[[]]</code>. 
The difference between these functions is that <code>[]</code> returns a <code class="sourceCode r">hyperSpec</code> object, whereas the result of <code>[[]]</code> is a <code class="sourceCode r">data.frame</code>.
<strong>hyperSpec</strong> objects are triple indexed:</p>
<ul>
<li><code class="sourceCode r">x[i, j, l]</code></li>
<li><code class="sourceCode r">x[[i, j, l]]</code></li>
<li>
<code>i</code> refers to rows of the <code class="sourceCode r"><span class="op">@</span>data</code> slot.</li>
<li>
<code>j</code> refers to columns of the <code class="sourceCode r"><span class="op">@</span>data</code> slot.</li>
<li>
<code>l</code> refers to wavelengths.</li>
<li>If there is only one index given, e.g. <code class="sourceCode r">x[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</code>, it refers to the row index <code>i</code>. Likewise if there are only two indices given they refer to <code>i</code> and <code>j</code>.</li>
</ul>
<div id="sec:fast-access-parts" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:fast-access-parts" class="anchor"></a><span class="header-section-number">3.1</span> Access Functions for <strong><em>hyperSpec</em></strong> Objects</h2>
<p>Table <a href="#tab:getters">3.1</a> shows the main functions that can be used with class <code class="sourceCode r">hyperSpec</code> to access the object (“getters”). Table <a href="#tab:setters">3.2</a> shows the main functions that can be used with class <code class="sourceCode r">hyperSpec</code> to modify the object (“setters”).</p>
<!-- ---------------------------------------------------------------------- -->
<table class="table">
<caption>
<strong><span id="tab:getters">Table 3.1: </span></strong> Getter functions for the slots of <code class="sourceCode r">hyperSpec</code> objects</caption>
<tbody>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[]</code></strong></td>
<td align="left">Returns the entire <code>hyperSpec</code> object unchanged.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[i, , ]</code></strong></td>
<td align="left">Returns the <code>hyperSpec</code> object with selected rows; equivalent to <code class="sourceCode r">x[i]</code>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[, j, ]</code></strong></td>
<td align="left"><strong>returns damaged object – investigate!</strong></td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[, , l]</code></strong></td>
<td align="left">Returns the <code>hyperSpec</code> object with selected wavelengths.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="op">$</span>spc</code>).</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[i, , ]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="op">$</span>spc</code>) with selected rows.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[, j, ]]</code></strong></td>
<td align="left">Returns a <code class="sourceCode r">data.frame</code> with the selected columns.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[, , l]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="op">$</span>spc</code>) with selected wavelengths.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x<span class="op">$</span>.</code></strong></td>
<td align="left">Returns the complete <code class="sourceCode r">data.frame</code> <code class="sourceCode r">x<span class="op">@</span>data</code>, with the spectra in column <code class="sourceCode r"><span class="op">$</span>spc</code>.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x<span class="op">$</span>..</code></strong></td>
<td align="left">Returns all the extra data (<code class="sourceCode r">x<span class="op">@</span>data</code> without <code class="sourceCode r">x<span class="op">$</span>spc</code>).</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r"><span class="kw">wl</span>()</code></strong></td>
<td align="left">Returns the wavelengths.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r"><span class="kw">labels</span>()</code></strong></td>
<td align="left">Returns the labels.</td>
</tr>
</tbody>
</table>
<!-- ---------------------------------------------------------------------- --><!-- ---------------------------------------------------------------------- --><table class="table">
<caption>
<strong><span id="tab:setters">Table 3.2: </span></strong> Setter functions for the slots of <code class="sourceCode r">hyperSpec</code> objects</caption>
<tbody>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[i, ,] &lt;-</code></strong></td>
<td align="left">Replaces the specified rows.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[, j,] &lt;-</code></strong></td>
<td align="left">Replaces the specified columns.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[, , l] &lt;-</code></strong></td>
<td align="left">Replace the specified wavelengths.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[i, ,]] &lt;-</code></strong></td>
<td align="left"><strong>does this make sense? – investigate!</strong></td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[, j,]] &lt;-</code></strong></td>
<td align="left"><strong>does this make sense? – investigate!</strong></td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[, , l]] &lt;-</code></strong></td>
<td align="left"><strong>does this make sense? – investigate!</strong></td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[i, , l]] &lt;-</code></strong></td>
<td align="left">Also, parts of the spectra matrix can be set (only indices for spectra and wavelength are allowed for this function).</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[i, j] &lt;-</code></strong></td>
<td align="left">Sets parts of <code class="sourceCode r">x<span class="op">@</span>data</code>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x<span class="op">$</span>.. &lt;-</code></strong></td>
<td align="left">Sets the extra data (<code class="sourceCode r">x<span class="op">@</span>data</code> without touching <code class="sourceCode r">x<span class="op">$</span>spc</code>). The column names must match exactly in this case.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">wl&lt;-</code></strong></td>
<td align="left">Set the wavelength vector.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">labels&lt;-</code></strong></td>
<td align="left">Set the labels.</td>
</tr>
</tbody>
</table>
<!-- ---------------------------------------------------------------------- --><p>For more details on <code>[]&lt;-</code>, <code>[[]]&lt;-</code>, and <code>$&lt;-</code>, see <a href="#sec:square-brack-replace">3.4.1</a> and <a href="#sec:accessing-extra-data">3.3</a>.</p>
</div>
<div id="sec:select-delete-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:select-delete-spectra" class="anchor"></a><span class="header-section-number">3.2</span> Selecting and Deleting Spectra</h2>
<p>The extraction function <code>[]</code> takes the spectra (rows) as the first argument (For detailed help: see <code class="sourceCode r">?<span class="st">"["</span></code>).
It may be a vector giving the indices of the spectra to extract (select), a vector with negative indices indicating, which spectra should be deleted, or a vector of logical values.
Note that a matrix given to <code>[]</code> will be treated as a vector.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>, col = <span class="st">"green2"</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>], add = <span class="fl">TRUE</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:selspc"></span>
<img src="hyperSpec_files/figure-html/selspc-1.png" alt="An example with `[]` operator and positive indices.  "><p class="caption">
Figure 3.1: An example with <code>[]</code> operator and positive indices.
</p>
</div>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>, col = <span class="st">"red"</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>[<span class="op">-</span><span class="fl">3</span>], add = <span class="fl">TRUE</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:delspc"></span>
<img src="hyperSpec_files/figure-html/delspc-1.png" alt="An example with `[]` operator and negative indices.  "><p class="caption">
Figure 3.2: An example with <code>[]</code> operator and negative indices.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>, col = <span class="st">"gold"</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu</span>[<span class="kw">flu</span><span class="op">$</span><span class="kw">c</span> <span class="op">&gt;</span> <span class="fl">0.2</span>], add = <span class="fl">TRUE</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:selspc2"></span>
<img src="hyperSpec_files/figure-html/selspc2-1.png" alt="An example with `[]` operator and logical indices.  "><p class="caption">
Figure 3.3: An example with <code>[]</code> operator and logical indices.
</p>
</div>
<div id="sec:random-samples" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:random-samples" class="anchor"></a><span class="header-section-number">3.2.1</span> Random Samples</h3>

<p>A random subset of spectra can be conveniently selected by <code class="sourceCode r"><span class="kw">sample</span>()</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw">chondro</span>, <span class="fl">3</span>)
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    3 spectra</span>
<span class="co">#&gt;    5 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (3 rows x 5 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] 6.23 1.23 12.23 </span>
<span class="co">#&gt;    2. x: x [numeric] 14.45 13.45 -8.55 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] cell   matrix matrix </span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 366.83 276.39 ... 127.09</span>
</pre></div>

<p>If indices into the selected spectra are needed instead, use <code class="sourceCode r"><span class="kw">isample</span>()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="../reference/sample,hyperSpec-method.html">isample</a></span>(<span class="kw">chondro</span>, <span class="fl">3</span>)
<span class="co">#&gt; [1] 534 728 321</span>
</pre></div>
</div>
<div id="sec:seq" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:seq" class="anchor"></a><span class="header-section-number">3.2.2</span> Sequences</h3>

<p>Sequences of every n<sup>th</sup> spectrum or the like can be retrieved with <code class="sourceCode r"><span class="kw">seq</span>()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="fu"><a href="../reference/seq.hyperSpec.html">seq</a></span>(<span class="kw">chondro</span>, length.out = <span class="fl">3</span>, index = <span class="fl">TRUE</span>)
<span class="co">#&gt; [1]   1 438 875</span>
<span class="fu"><a href="../reference/seq.hyperSpec.html">seq</a></span>(<span class="kw">chondro</span>, by = <span class="fl">100</span>)
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    9 spectra</span>
<span class="co">#&gt;    5 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (9 rows x 5 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] -4.77 -2.77 ... 17.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -11.55 18.45 ... 18.45 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] matrix matrix ... lacuna </span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 501.82 400.94 ... 124.64</span>
</pre></div>
<p>Here, indices may be requested using <code class="sourceCode r">index =<span class="st"> </span><span class="ot">TRUE</span></code>.</p>
</div>
</div>
<div id="sec:accessing-extra-data" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:accessing-extra-data" class="anchor"></a><span class="header-section-number">3.3</span> Selecting Extra Data Columns</h2>
<p>The second argument of the extraction functions <code>[]</code> and <code>[[]]</code> specifies the (extra) data columns.
They can be given like any column specification for a <code class="sourceCode r">data.frame</code>, i.e., numeric, logical, or by a vector of the column names:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="../reference/dimnames,hyperSpec-method.html">colnames</a></span>(<span class="kw">chondro</span>)
<span class="co">#&gt; [1] "y"        "x"        "filename" "clusters" "spc"</span>
</pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">chondro</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span>]]
<span class="co">#&gt;       y</span>
<span class="co">#&gt; 1 -4.77</span>
<span class="co">#&gt; 2 -4.77</span>
<span class="co">#&gt; 3 -4.77</span>
</pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">chondro</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">5</span>]]
<span class="co">#&gt;       y      x            filename clusters</span>
<span class="co">#&gt; 1 -4.77 -11.55 rawdata/chondro.txt   matrix</span>
<span class="co">#&gt; 2 -4.77 -10.55 rawdata/chondro.txt   matrix</span>
<span class="co">#&gt; 3 -4.77  -9.55 rawdata/chondro.txt   matrix</span>
</pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">chondro</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="st">"x"</span>]]
<span class="co">#&gt;        x</span>
<span class="co">#&gt; 1 -11.55</span>
<span class="co">#&gt; 2 -10.55</span>
<span class="co">#&gt; 3  -9.55</span>
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">chondro</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)]] <span class="co"># note the recycling!</span>
<span class="co">#&gt;        x clusters</span>
<span class="co">#&gt; 1 -11.55   matrix</span>
<span class="co">#&gt; 2 -10.55   matrix</span>
<span class="co">#&gt; 3  -9.55   matrix</span>
</pre></div>

<p>To select one column, the <code class="sourceCode r"><span class="op">$</span></code> operator is more convenient:</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">flu</span><span class="op">$</span><span class="kw">c</span>
<span class="co">#&gt; [1] 0.05 0.10 0.15 0.20 0.25 0.30</span>
</pre></div>
<p>Class <code class="sourceCode r">hyperSpec</code> supports command line completion for the <code class="sourceCode r"><span class="op">$</span></code> operator.</p>

<p>The extra data may also be set this way:</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">flu</span><span class="op">$</span><span class="kw">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, label = <span class="st">"sample no."</span>)
</pre></div>
<p>This function will append new columns, if necessary.</p>
</div>
<div id="double-square-brackets" class="section level2">
<h2 class="hasAnchor">
<a href="#double-square-brackets" class="anchor"></a><span class="header-section-number">3.4</span> More on the <code>[[]]</code> and <code>[[]]&lt;-</code>
</h2>
<div id="sec:square-brack-replace" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:square-brack-replace" class="anchor"></a><span class="header-section-number">3.4.1</span> Operators: Accessing Single Elements of the Spectra Matrix</h3>
<p>Operator <code>[[]]</code> works mostly analogous to <code>[]</code>.
In addition, however, these two functions also accept index matrices of size <span class="math inline">\(n × 2\)</span>.
In this case, a vector of values from the spectra matrix is returned.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">indexmatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>), ncol = <span class="fl">2</span>)
<span class="kw">indexmatrix</span>
<span class="co">#&gt;      [,1] [,2]</span>
<span class="co">#&gt; [1,]    1    1</span>
<span class="co">#&gt; [2,]    2    2</span>
<span class="co">#&gt; [3,]    3    3</span>
</pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">chondro</span>[[<span class="kw">indexmatrix</span>, wl.index = <span class="fl">TRUE</span>]]
<span class="co">#&gt; [1] 501.82 507.81 456.03</span>
</pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="kw">chondro</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="kw">min</span> <span class="op">~</span> <span class="kw">min</span> <span class="op">+</span> <span class="fl">2i</span>]])
<span class="co">#&gt; [1] 501.82 507.81 456.03</span>
</pre></div>
<p>Operator <code>[[]]&lt;-</code> also accepts index matrices of size <span class="math inline">\(n × 2\)</span>.</p>
</div>
</div>
<div id="sec:wavelength-axis" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:wavelength-axis" class="anchor"></a><span class="header-section-number">3.5</span> Wavelengths</h2>
<p>

</p>
<div id="sec:wavelength-indices" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:wavelength-indices" class="anchor"></a><span class="header-section-number">3.5.1</span> Converting Wavelengths to Indices and vice versa</h3>

<p>Spectra in package <strong>hyperSpec</strong> always have discretized wavelength axes, stored in a matrix with each column corresponding to one wavelength.
Package <strong>hyperSpec</strong> provides two functions to convert the respective column indices into wavelengths and vice versa: <code class="sourceCode r"><span class="kw">i2wl</span>()</code> and <code class="sourceCode r"><span class="kw">wl2i</span>()</code>.</p>
<p>If the wavelengths are given as a numeric vector, they are each converted to the corresponding wavelength.
In addition there is a more sophisticated possibility of specifying wavelength ranges using a <em>formula</em>.
The basic syntax is <strong><code>start ~ end</code></strong>.
This yields a vector <strong><code>index_of_start : index_of_end</code></strong>.</p>
<p>The result of the formula conversion differs from the numeric vector conversion in three ways:</p>
<ul>
<li>The colon operator for constructing vectors accepts only integer numbers, the tilde (for formulas) does not have this restriction.</li>
<li>If the vector does not take into account the spectral resolution, one may get only every <span class="math inline">\(n\)</span><sup>th</sup> point or repetitions of the same index:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="fl">405</span><span class="op">:</span><span class="fl">410</span>)
<span class="co">#&gt; [1]  1  3  5  7  9 11</span>
</pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="fl">405</span> <span class="op">~</span> <span class="fl">410</span>)
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11</span>
</pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">chondro</span>, <span class="fl">1000</span><span class="op">:</span><span class="fl">1010</span>)
<span class="co">#&gt;  [1] 100 101 101 101 101 102 102 102 102 103 103</span>
</pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">chondro</span>, <span class="fl">1000</span> <span class="op">~</span> <span class="fl">1010</span>)
<span class="co">#&gt; [1] 100 101 102 103</span>
</pre></div>
<ul>
<li>If the object’s wavelength axis is not ordered, the formula approach will give weird results.
In that (probably rare) case, use <code class="sourceCode r"><span class="kw">orderwl</span>()</code> first to obtain an object with ordered wavelength axis.</li>
</ul>
<p>Values <em>start</em> and <em>end</em> may contain the special variables <code class="sourceCode r">min</code> and <code class="sourceCode r">max</code> that
correspond to the lowest and highest wavelengths of the object:</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="kw">min</span> <span class="op">~</span> <span class="fl">410</span>)
<span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11</span>
</pre></div>
<p>Often, specifications like <em>“wavelength <span class="math inline">\(pm n\)</span> data points”</em> are needed.
They can be given using complex numbers in the formula.
The imaginary part is added to the index calculated from the wavelength in the real part:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="fl">450</span> <span class="op">-</span> <span class="fl">2i</span> <span class="op">~</span> <span class="fl">450</span> <span class="op">+</span> <span class="fl">2i</span>)
<span class="co">#&gt; [1] 89 90 91 92 93</span>
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="kw">max</span> <span class="op">-</span> <span class="fl">2i</span> <span class="op">~</span> <span class="kw">max</span>)
<span class="co">#&gt; [1] 179 180 181</span>
</pre></div>
<p>To specify several wavelength ranges, use a list containing the formulas and vectors<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="../reference/wl2i.html">wl2i</a></span>(<span class="kw">flu</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">min</span> <span class="op">~</span> <span class="fl">406.5</span>, <span class="kw">max</span> <span class="op">-</span> <span class="fl">2i</span> <span class="op">~</span> <span class="kw">max</span>))
<span class="co">#&gt; [1]   1   2   3   4 179 180 181</span>
</pre></div>
<p>This mechanism also works for the wavelength arguments of <code>[]</code>, <code>[[]]</code>, and <code class="sourceCode r"><span class="kw">plotspc</span>()</code>.</p>
</div>
<div id="selecting-wavelength-ranges" class="section level3">
<h3 class="hasAnchor">
<a href="#selecting-wavelength-ranges" class="anchor"></a><span class="header-section-number">3.5.2</span> Selecting Wavelength Ranges</h3>
<p>Wavelength ranges can easily be selected using <code>[]</code>’s third argument (Fig. <a href="#fig:paracetamol">3.4</a>).</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>[, , <span class="fl">2800</span> <span class="op">~</span> <span class="fl">3200</span>])
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:paracetamol"></span>
<img src="hyperSpec_files/figure-html/paracetamol-1.png" alt="Spectra of `paracetamol` in range of 2800--3200 cm^-1^."><p class="caption">
Figure 3.4: Spectra of <code>paracetamol</code> in range of 2800–3200 cm<sup>-1</sup>.
</p>
</div>
<p>By default, the values given are treated as wavelengths.
If they are indices into the columns of the spectra matrix, use <code class="sourceCode r">wl.index =<span class="st"> </span><span class="ot">TRUE</span></code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>[, , <span class="fl">2800</span><span class="op">:</span><span class="fl">3200</span>, wl.index = <span class="fl">TRUE</span>])
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-11"></span>
<img src="hyperSpec_files/figure-html/unnamed-chunk-11-1.png" alt="Spectra of `paracetamol`: from 2800^th^ to 3200^th^ point on *wavelength* axis.  "><p class="caption">
Figure 3.5: Spectra of <code>paracetamol</code>: from 2800<sup>th</sup> to 3200<sup>th</sup> point on <em>wavelength</em> axis.
</p>
</div>
<p>Section <a href="#sec:wavelength-indices">3.5.1</a> delves into the different possibilities of specifying wavelengths.</p>
</div>
<div id="sec:del-wavelengths" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:del-wavelengths" class="anchor"></a><span class="header-section-number">3.5.3</span> Deleting Wavelength Ranges</h3>
<p>Deleting wavelength ranges may be accomplished using negative index vectors together with <code class="sourceCode r">wl.index =<span class="st"> </span><span class="ot">TRUE</span></code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>[, , <span class="op">-</span>(<span class="fl">500</span><span class="op">:</span><span class="fl">1000</span>), wl.index = <span class="fl">TRUE</span>])
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-13"></span>
<img src="hyperSpec_files/figure-html/unnamed-chunk-13-1.png" alt="Spectra of `paracetamol` with 500^th^ to 1000^th^ *wavelength* axis point removed.  "><p class="caption">
Figure 3.6: Spectra of <code>paracetamol</code> with 500<sup>th</sup> to 1000<sup>th</sup><em>wavelength</em> axis point removed.
</p>
</div>
<p>However, this mechanism works only if the proper indices are known.</p>
<p>If the range to be removed is instead specified in the units of the wavelength axis, it is easier to select the remainder of the spectrum instead.
To delete the spectral range from 1750 to 2800 cm<sup>-1</sup> of the paracetamol spectrum one can use:</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>[, , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">min</span> <span class="op">~</span> <span class="fl">1750</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="kw">max</span>)])
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-15"></span>
<img src="hyperSpec_files/figure-html/unnamed-chunk-15-1.png" alt="Spectra of `paracetamol` with range from 1750 to 2800 cm^-1^ removed.  "><p class="caption">
Figure 3.7: Spectra of <code>paracetamol</code> with range from 1750 to 2800 cm<sup>-1</sup> removed.
</p>
</div>
<p>It is possible to produce a plot of this data where the cut range is actually omitted and the wavelength axis is optionally cut in order to save space.
For details see the “Plotting” vignette.</p>
</div>
<div id="sec:wavel-axis-conv" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:wavel-axis-conv" class="anchor"></a><span class="header-section-number">3.5.4</span> Changing the Wavelength Axis</h3>
<p>

Sometimes wavelength axes need to be transformed, e.g., converting from wavelengths to frequencies.
In this case, retrieve the wavelength axis vector with <code class="sourceCode r"><span class="kw">wl</span>()</code>, convert each value of the resulting vector and assign the result with <code class="sourceCode r">wl&lt;-</code>.
Also the label of the wavelength axis may need to be adjusted.</p>
<p>As an example, convert the wavelength axis of <code class="sourceCode r">laser</code> to frequencies.
As the wavelengths are in nanometers, and the frequencies are easiest expressed in terahertz, an additional conversion factor of 1000 is needed:</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="kw">laser</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    84 spectra</span>
<span class="co">#&gt;    3 data columns</span>
<span class="co">#&gt;    36 data points / spectrum</span>
<span class="co">#&gt; wavelength: lambda/nm [numeric] 404.58 404.62 ... 405.82 </span>
<span class="co">#&gt; data:  (84 rows x 3 columns)</span>
<span class="co">#&gt;    1. t: t / s [numeric] 0 2 ... 5722 </span>
<span class="co">#&gt;    2. spc: I / a.u. [matrix, array36] 164.65 179.72 ... 112.09 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/laser.txt.gz rawdata/laser.txt.gz ... rawdata/laser.txt.gz</span>
</pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="kw">wavelengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">laser</span>)
<span class="kw">frequencies</span> <span class="op">&lt;-</span> <span class="fl">2.998e8</span> <span class="op">/</span> <span class="kw">wavelengths</span> <span class="op">/</span> <span class="fl">1000</span>
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">laser</span>) <span class="op">&lt;-</span> <span class="kw">frequencies</span>
<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="kw">laser</span>, <span class="st">".wavelength"</span>) <span class="op">&lt;-</span> <span class="st">"f / THz"</span>
<span class="kw">laser</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    84 spectra</span>
<span class="co">#&gt;    3 data columns</span>
<span class="co">#&gt;    36 data points / spectrum</span>
<span class="co">#&gt; wavelength: f / THz [numeric] 741.01 740.95 ... 738.76 </span>
<span class="co">#&gt; data:  (84 rows x 3 columns)</span>
<span class="co">#&gt;    1. t: t / s [numeric] 0 2 ... 5722 </span>
<span class="co">#&gt;    2. spc: I / a.u. [matrix, array36] 164.65 179.72 ... 112.09 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/laser.txt.gz rawdata/laser.txt.gz ... rawdata/laser.txt.gz</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">laser</span>)
</pre></div>
<p>There are other possibilities of invoking <code class="sourceCode r">wl&lt;-</code> including the new label, e.g.,</p>
<div class="sourceCode" id="cb36"><pre class="downlit">
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">laser</span>, <span class="st">"f / THz"</span>) <span class="op">&lt;-</span> <span class="kw">frequencies</span>
</pre></div>
<p>and</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">laser</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(wl = <span class="kw">frequencies</span>, label = <span class="st">"f / THz"</span>)
</pre></div>
<p>see <code>?wl&lt;-</code> for more information.</p>
</div>
<div id="sec:orderwl" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:orderwl" class="anchor"></a><span class="header-section-number">3.5.5</span> Ordering the Wavelength Axis</h3>

<p>If the wavelength axis of an object needs reordering (e.g., after <code class="sourceCode r"><span class="kw">collapse</span>()</code>), <code class="sourceCode r"><span class="kw">orderwl</span>()</code> can be used:</p>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="kw">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse.html">collapse</a></span>(<span class="kw">barbiturates</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>])
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">barb</span>)
<span class="co">#&gt;  [1]  27.05  27.15  28.05  28.15  29.05  30.05  30.15  31.15  32.15  39.00  40.00  40.10  41.10</span>
<span class="co">#&gt; [14]  43.05  43.85  43.95  44.05  55.00  55.10  56.00  56.10  57.10  68.90  69.00  69.10  70.00</span>
<span class="co">#&gt; [27]  71.10  71.90  72.00  77.00  82.95  83.05  84.15  85.05  91.00  96.95  98.95 105.10 105.90</span>
<span class="co">#&gt; [40] 106.00 112.90 113.00 116.95 117.95 118.05 119.05 119.15 119.95 120.05 130.90 131.00 132.95</span>
<span class="co">#&gt; [53] 133.05 140.90 147.00 158.85 160.90</span>
</pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="kw">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orderwl.html">orderwl</a></span>(<span class="kw">barb</span>)
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">barb</span>)
<span class="co">#&gt;  [1]  27.05  27.15  28.05  28.15  29.05  30.05  30.15  31.15  32.15  39.00  40.00  40.10  41.10</span>
<span class="co">#&gt; [14]  43.05  43.85  43.95  44.05  55.00  55.10  56.00  56.10  57.10  68.90  69.00  69.10  70.00</span>
<span class="co">#&gt; [27]  71.10  71.90  72.00  77.00  82.95  83.05  84.15  85.05  91.00  96.95  98.95 105.10 105.90</span>
<span class="co">#&gt; [40] 106.00 112.90 113.00 116.95 117.95 118.05 119.05 119.15 119.95 120.05 130.90 131.00 132.95</span>
<span class="co">#&gt; [53] 133.05 140.90 147.00 158.85 160.90</span>
</pre></div>
</div>
</div>
<div id="sec:conv-long-form" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:conv-long-form" class="anchor"></a><span class="header-section-number">3.6</span> Conversion to Long- and Wide-Format <code class="sourceCode r">data.frame</code>s</h2>

<p>Function <code class="sourceCode r"><span class="kw">as.data.frame</span>()</code> extracts the <code class="sourceCode r"><span class="op">@</span>data</code> slot as a <code class="sourceCode r">data.frame</code>:</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="kw">flu</span> <span class="op">&lt;-</span> <span class="kw">flu</span>[, , <span class="fl">400</span> <span class="op">~</span> <span class="fl">407</span>] <span class="co"># make a small and handy version of the flu data set</span>
<span class="fu"><a href="../reference/as.data.frame.html">as.data.frame</a></span>(<span class="kw">flu</span>)
<span class="co">#&gt;   spc.405 spc.405.5 spc.406 spc.406.5 spc.407         filename    c n .row</span>
<span class="co">#&gt; 1  27.150    32.345  33.379    34.419  36.531 rawdata/flu1.txt 0.05 1    1</span>
<span class="co">#&gt; 2  66.801    63.715  66.712    69.582  72.530 rawdata/flu2.txt 0.10 2    2</span>
<span class="co">#&gt; 3  93.144   103.068 106.194   110.186 113.249 rawdata/flu3.txt 0.15 3    3</span>
<span class="co">#&gt; 4 130.664   139.998 143.798   148.420 152.133 rawdata/flu4.txt 0.20 4    4</span>
<span class="co">#&gt; 5 167.267   171.898 177.471   184.625 189.752 rawdata/flu5.txt 0.25 5    5</span>
<span class="co">#&gt; 6 198.430   209.458 215.785   224.587 232.528 rawdata/flu6.txt 0.30 6    6</span>
</pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="fu"><a href="../reference/dimnames,hyperSpec-method.html">colnames</a></span>(<span class="fu"><a href="../reference/as.data.frame.html">as.data.frame</a></span>(<span class="kw">flu</span>))
<span class="co">#&gt; [1] "spc"      "filename" "c"        "n"        ".row"</span>
</pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit">
<span class="fu"><a href="../reference/as.data.frame.html">as.data.frame</a></span>(<span class="kw">flu</span>)<span class="op">$</span><span class="kw">spc</span>
<span class="co">#&gt;          405   405.5     406   406.5     407</span>
<span class="co">#&gt; [1,]  27.150  32.345  33.379  34.419  36.531</span>
<span class="co">#&gt; [2,]  66.801  63.715  66.712  69.582  72.530</span>
<span class="co">#&gt; [3,]  93.144 103.068 106.194 110.186 113.249</span>
<span class="co">#&gt; [4,] 130.664 139.998 143.798 148.420 152.133</span>
<span class="co">#&gt; [5,] 167.267 171.898 177.471 184.625 189.752</span>
<span class="co">#&gt; [6,] 198.430 209.458 215.785 224.587 232.528</span>
</pre></div>
<p>Note that the spectra matrix is still a matrix inside column <code class="sourceCode r"><span class="op">$</span>spc</code>.</p>

<p>Function <code class="sourceCode r"><span class="kw">as.data.frame</span>()</code> and the abbreviations <code class="sourceCode r"><span class="op">$</span>.</code> and <code class="sourceCode r"><span class="op">$</span>..</code> retrieve the usual wide format <code class="sourceCode r">data.frame</code>s:</p>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="kw">flu</span><span class="op">$</span><span class="kw">.</span>
<span class="co">#&gt;   spc.405 spc.405.5 spc.406 spc.406.5 spc.407         filename    c n</span>
<span class="co">#&gt; 1  27.150    32.345  33.379    34.419  36.531 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2  66.801    63.715  66.712    69.582  72.530 rawdata/flu2.txt 0.10 2</span>
<span class="co">#&gt; 3  93.144   103.068 106.194   110.186 113.249 rawdata/flu3.txt 0.15 3</span>
<span class="co">#&gt; 4 130.664   139.998 143.798   148.420 152.133 rawdata/flu4.txt 0.20 4</span>
<span class="co">#&gt; 5 167.267   171.898 177.471   184.625 189.752 rawdata/flu5.txt 0.25 5</span>
<span class="co">#&gt; 6 198.430   209.458 215.785   224.587 232.528 rawdata/flu6.txt 0.30 6</span>
</pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="kw">flu</span><span class="op">$</span><span class="kw">..</span>
<span class="co">#&gt;           filename    c n</span>
<span class="co">#&gt; 1 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2 rawdata/flu2.txt 0.10 2</span>
<span class="co">#&gt; 3 rawdata/flu3.txt 0.15 3</span>
<span class="co">#&gt; 4 rawdata/flu4.txt 0.20 4</span>
<span class="co">#&gt; 5 rawdata/flu5.txt 0.25 5</span>
<span class="co">#&gt; 6 rawdata/flu6.txt 0.30 6</span>
</pre></div>

<p>If another subset of colums needs to be extracted, use <code>[[]]</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="kw">flu</span>[[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"c"</span>, <span class="st">"spc"</span>)]]
<span class="co">#&gt;      c spc.405 spc.405.5 spc.406 spc.406.5 spc.407</span>
<span class="co">#&gt; 1 0.05  27.150    32.345  33.379    34.419  36.531</span>
<span class="co">#&gt; 2 0.10  66.801    63.715  66.712    69.582  72.530</span>
<span class="co">#&gt; 3 0.15  93.144   103.068 106.194   110.186 113.249</span>
<span class="co">#&gt; 4 0.20 130.664   139.998 143.798   148.420 152.133</span>
<span class="co">#&gt; 5 0.25 167.267   171.898 177.471   184.625 189.752</span>
<span class="co">#&gt; 6 0.30 198.430   209.458 215.785   224.587 232.528</span>
</pre></div>
<p>This can be combined with extracting certain spectra and wavelengths, see <a href="#sec:conv-matrix">3.7</a>.</p>

<p>The transpose of a wide format <code class="sourceCode r">data.frame</code> can be obtained by <code class="sourceCode r"><span class="kw">as.t.df</span>()</code>. For further examples, see the discussion of package <strong>ggplot2</strong> in <code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"plotting"</span>)</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="fu"><a href="../reference/as.data.frame.html">as.t.df</a></span>(<span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">flu</span>, <span class="fl">2</span>, <span class="kw">mean_pm_sd</span>))
<span class="co">#&gt;           .wavelength mean.minus.sd   mean mean.plus.sd</span>
<span class="co">#&gt; spc.405         405.0        49.958 113.91       177.86</span>
<span class="co">#&gt; spc.405.5       405.5        53.396 120.08       186.77</span>
<span class="co">#&gt; spc.406         406.0        55.352 123.89       192.43</span>
<span class="co">#&gt; spc.406.5       406.5        57.310 128.64       199.96</span>
<span class="co">#&gt; spc.407         407.0        59.513 132.79       206.06</span>
</pre></div>

<p>Some functions need the data being an <em>unstacked</em> or <em>long-format</em> <code class="sourceCode r">data.frame</code>.
Function <code class="sourceCode r"><span class="kw">as.long.df</span>()</code> is the appropriate conversion function.</p>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/as.data.frame.html">as.long.df</a></span>(<span class="kw">flu</span>), <span class="fl">20</span>)
<span class="co">#&gt;     .wavelength     spc         filename    c n</span>
<span class="co">#&gt; 1         405.0  27.150 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2         405.0  66.801 rawdata/flu2.txt 0.10 2</span>
<span class="co">#&gt; 3         405.0  93.144 rawdata/flu3.txt 0.15 3</span>
<span class="co">#&gt; 4         405.0 130.664 rawdata/flu4.txt 0.20 4</span>
<span class="co">#&gt; 5         405.0 167.267 rawdata/flu5.txt 0.25 5</span>
<span class="co">#&gt; 6         405.0 198.430 rawdata/flu6.txt 0.30 6</span>
<span class="co">#&gt; 1.1       405.5  32.345 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2.1       405.5  63.715 rawdata/flu2.txt 0.10 2</span>
<span class="co">#&gt; 3.1       405.5 103.068 rawdata/flu3.txt 0.15 3</span>
<span class="co">#&gt; 4.1       405.5 139.998 rawdata/flu4.txt 0.20 4</span>
<span class="co">#&gt; 5.1       405.5 171.898 rawdata/flu5.txt 0.25 5</span>
<span class="co">#&gt; 6.1       405.5 209.458 rawdata/flu6.txt 0.30 6</span>
<span class="co">#&gt; 1.2       406.0  33.379 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2.2       406.0  66.712 rawdata/flu2.txt 0.10 2</span>
<span class="co">#&gt; 3.2       406.0 106.194 rawdata/flu3.txt 0.15 3</span>
<span class="co">#&gt; 4.2       406.0 143.798 rawdata/flu4.txt 0.20 4</span>
<span class="co">#&gt; 5.2       406.0 177.471 rawdata/flu5.txt 0.25 5</span>
<span class="co">#&gt; 6.2       406.0 215.785 rawdata/flu6.txt 0.30 6</span>
<span class="co">#&gt; 1.3       406.5  34.419 rawdata/flu1.txt 0.05 1</span>
<span class="co">#&gt; 2.3       406.5  69.582 rawdata/flu2.txt 0.10 2</span>
</pre></div>
</div>
<div id="sec:conv-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:conv-matrix" class="anchor"></a><span class="header-section-number">3.7</span> Conversion to Matrix</h2>

<p>The spectra matrix is extracted by <code class="sourceCode r"><span class="kw">as.matrix</span>()</code>, the convenient abbreviation is <code>[[]]</code>:</p>
<div class="sourceCode" id="cb48"><pre class="downlit">
<span class="kw">flu</span>[[]]
<span class="co">#&gt;          405   405.5     406   406.5     407</span>
<span class="co">#&gt; [1,]  27.150  32.345  33.379  34.419  36.531</span>
<span class="co">#&gt; [2,]  66.801  63.715  66.712  69.582  72.530</span>
<span class="co">#&gt; [3,]  93.144 103.068 106.194 110.186 113.249</span>
<span class="co">#&gt; [4,] 130.664 139.998 143.798 148.420 152.133</span>
<span class="co">#&gt; [5,] 167.267 171.898 177.471 184.625 189.752</span>
<span class="co">#&gt; [6,] 198.430 209.458 215.785 224.587 232.528</span>
</pre></div>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="kw">flu</span>[[]])
<span class="co">#&gt; [1] "matrix" "array"</span>
</pre></div>
<p>Operator <code>[[]]</code> takes the same arguments as <code>[]</code>, and can be used to extract a matrix containing parts of the spectra matrix:</p>
<div class="sourceCode" id="cb50"><pre class="downlit">
<span class="kw">flu</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="fl">406</span> <span class="op">~</span> <span class="fl">407</span>]]
<span class="co">#&gt;          406   406.5     407</span>
<span class="co">#&gt; [1,]  33.379  34.419  36.531</span>
<span class="co">#&gt; [2,]  66.712  69.582  72.530</span>
<span class="co">#&gt; [3,] 106.194 110.186 113.249</span>
</pre></div>
<p>If indices for the columns to extract are given, a <code class="sourceCode r">data.frame</code> is returned instead of a matrix:</p>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="kw">flu</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"filename"</span>, <span class="st">"spc"</span>), <span class="fl">406</span> <span class="op">~</span> <span class="fl">407</span>]]
<span class="co">#&gt;           filename spc.406 spc.406.5 spc.407</span>
<span class="co">#&gt; 1 rawdata/flu1.txt  33.379    34.419  36.531</span>
<span class="co">#&gt; 2 rawdata/flu2.txt  66.712    69.582  72.530</span>
<span class="co">#&gt; 3 rawdata/flu3.txt 106.194   110.186 113.249</span>
</pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">flu</span>)
</pre></div>
</div>
</div>
<div id="sec:create" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:create" class="anchor"></a><span class="header-section-number">4</span> Creating a <strong><em>hyperSpec</em></strong> Object, Data Import and Export</h1>
<p>Package <strong>hyperSpec</strong> comes with filters for a variety of file formats.
These are discussed in detail in a separate vignette accessible via <code><a href="../articles/fileio.html">vignette("fileio")</a></code>. Here we just mention a couple of basic operations.</p>
<div id="creating-a-hyperspec-object-from-spectra-matrix-and-wavelength-vector" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-hyperspec-object-from-spectra-matrix-and-wavelength-vector" class="anchor"></a><span class="header-section-number">4.1</span> Creating a <code class="sourceCode r">hyperSpec</code> Object from Spectra Matrix and Wavelength Vector</h2>
<p>If the data is in <code>R</code>’s workspace, a <code>hyperSpec</code> object is created by:</p>
<div class="sourceCode" id="cb53"><pre class="downlit">
<span class="kw">spc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/initialize.html">new</a></span>(<span class="st">"hyperSpec"</span>, spc = <span class="kw">spectra.matrix</span>, wavelength = <span class="kw">wavelength.vector</span>, data = <span class="kw">extra.data</span>)
</pre></div>
<p>The most frequently needed arguments are:</p>
<table class="table">
<colgroup>
<col width="20%">
<col width="79%">
</colgroup>
<tbody>
<tr class="odd">
<td>
<strong><code>spc</code></strong> The</td>
<td align="left">spectra matrix; may be a matrix or a <code>data.frame</code>.</td>
</tr>
<tr class="even">
<td>
<strong><code>wavelength</code></strong> The</td>
<td align="left">wavelength axis as a numeric vector.</td>
</tr>
<tr class="odd">
<td>
<strong><code>data</code></strong> Any</td>
<td align="left">extra data as a <code>data.frame</code>. It is possible to pass <code>spc</code> via this argument if the data frame has a column <code class="sourceCode r"><span class="op">$</span>spc</code>.</td>
</tr>
<tr class="even">
<td>
<strong><code>label</code></strong> A li</td>
<td align="left">st with the proper labels.
Do not forget the wavelength axis label in <code class="sourceCode r"><span class="op">$</span>.wavelength</code> and the
spectral intensity axis label in <code class="sourceCode r"><span class="op">$</span>spc</code>.</td>
</tr>
</tbody>
</table>
<p>More information about converting existing data into <code class="sourceCode r">hyperSpec</code> objects can be found in <code class="sourceCode r"><span class="kw">vignette</span> (<span class="st">"fileio"</span>)</code>.</p>
</div>
<div id="creating-random-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-random-spectra" class="anchor"></a><span class="header-section-number">4.2</span> Creating Random Spectra</h2>

<p>If package <strong>mvtnorm</strong><span class="citation">[<a href="#ref-mvtnorm" role="doc-biblioref">1</a>]</span> is available, multivariate normally distributed spectra can be generated from mean and covariance matrix using <code class="sourceCode r"><span class="kw">rmmvnorm</span>()</code> (Fig. <a href="#fig:sim-spc">4.1</a>).
Note that the package <strong>hyperSpec</strong> function’s name has an additional “m”: it already takes care of multiple groups.
Mean spectra and pooled covariance matrix can be calculated using <code class="sourceCode r"><span class="kw">pooled.cov</span>()</code>:</p>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="kw">pcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cov,hyperSpec,missing-method.html">pooled.cov</a></span>(<span class="kw">chondro</span>, <span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="kw">rnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmmvnorm.html">rmmvnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">10</span>, <span class="fl">3</span>), mean = <span class="kw">pcov</span><span class="op">$</span><span class="kw">mean</span>, sigma = <span class="kw">pcov</span><span class="op">$</span><span class="kw">COV</span>)
</pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit">
<span class="kw">cluster.cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dark blue"</span>, <span class="st">"orange"</span>, <span class="st">"#C02020"</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">rnd</span>, col = <span class="kw">cluster.cols</span>[<span class="kw">rnd</span><span class="op">$</span><span class="kw">.group</span>])
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:sim-spc"></span>
<img src="hyperSpec_files/figure-html/sim-spc-1.png" alt="Multivariate normally distributed random spectra generated with `rmmvnorm()`{.r}."><p class="caption">
Figure 4.1: Multivariate normally distributed random spectra generated with <code class="sourceCode r"><span class="kw">rmmvnorm</span>()</code>.
</p>
</div>
<p>Fig. <a href="#fig:sim-lda">4.2</a> shows the linear discriminant analysis (LDA) scores of simulated spectra in comparison to the real spectra in the <code class="sourceCode r">chondro</code> object:</p>
<div class="sourceCode" id="cb56"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st"><a href="http://www.stats.ox.ac.uk/pub/MASS4">"MASS"</a></span>)

<span class="kw">rnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmmvnorm.html">rmmvnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">200</span>, <span class="fl">3</span>), mean = <span class="kw">pcov</span><span class="op">$</span><span class="kw">mean</span>, sigma = <span class="kw">pcov</span><span class="op">$</span><span class="kw">COV</span>)
<span class="kw">lda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span>(<span class="kw">clusters</span> <span class="op">~</span> <span class="kw">spc</span>, <span class="kw">rnd</span>)

<span class="kw">pred.chondro</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">lda</span>, newdata = <span class="kw">chondro</span>)
<span class="co">#&gt; Warning in predict.lda(lda, newdata = chondro): variable names in 'newdata' do not match those in</span>
<span class="co">#&gt; 'object'</span>
<span class="kw">pred.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw">lda</span>)
</pre></div>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
<div class="sourceCode" id="cb57"><pre class="downlit">
<span class="kw">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#00008040"</span>, <span class="st">"#FFA50040"</span>, <span class="st">"#C0202040"</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">pred.chondro</span><span class="op">$</span><span class="kw">x</span>, col = <span class="kw">colors</span>[<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>], pch = <span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw">pred.sim</span><span class="op">$</span><span class="kw">x</span>, col = <span class="kw">colors</span>[<span class="kw">rnd</span><span class="op">$</span><span class="kw">clusters</span>], pch = <span class="fl">20</span>, cex = <span class="fl">0.5</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:sim-lda"></span>
<img src="hyperSpec_files/figure-html/sim-lda-1.png" alt="LDA of simulated spectra. Crosses mark real spectra. "><p class="caption">
Figure 4.2: LDA of simulated spectra. Crosses mark real spectra.
</p>
</div>
<p>If individual covariance matrices should be used for each group, <code class="sourceCode r">sigma</code> should be an array with the 3rd dimension corresponding to the group.</p>
</div>
</div>
<div id="sec:combine" class="section level1">
<h1 class="hasAnchor">
<a href="#sec:combine" class="anchor"></a><span class="header-section-number">5</span> Combining and Decomposing <code class="sourceCode r">hyperSpec</code> Objects</h1>
<div id="sec:bind" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:bind" class="anchor"></a><span class="header-section-number">5.1</span> Binding Objects together</h2>

<p>Class <code class="sourceCode r">hyperspec</code> objects can be bound together, either by columns (<code class="sourceCode r"><span class="kw">cbind</span>()</code>) to append a new spectral range or by row (<code class="sourceCode r"><span class="kw">rbind</span>()</code>) to append new spectra:</p>
<div class="sourceCode" id="cb58"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="kw">flu</span>)
<span class="co">#&gt; nrow ncol  nwl </span>
<span class="co">#&gt;    6    3  181</span>
</pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">flu</span>, <span class="kw">flu</span>))
<span class="co">#&gt; nrow ncol  nwl </span>
<span class="co">#&gt;    6    3  362</span>
</pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">flu</span>, <span class="kw">flu</span>))
<span class="co">#&gt; nrow ncol  nwl </span>
<span class="co">#&gt;   12    3  181</span>
</pre></div>
<p>There is also a more general function, <code class="sourceCode r"><span class="kw">bind</span>()</code>, taking the direction (<code class="sourceCode r"><span class="st">"r"</span></code> or <code class="sourceCode r"><span class="st">"c"</span></code>) as first argument followed by the objects to bind either in separate arguments or in a list.</p>
<p>As usual for <code class="sourceCode r"><span class="kw">rbind</span>()</code> and <code class="sourceCode r"><span class="kw">cbind</span>()</code>, the objects that should be bound together must have
the same number of columns (for <code class="sourceCode r"><span class="kw">rbind</span>()</code>) and the same number of rows (for <code class="sourceCode r"><span class="kw">cbind</span>()</code>),
respectively.</p>

<p>For binding row-wise (<code class="sourceCode r"><span class="kw">rbind</span>()</code>), <code class="sourceCode r"><span class="kw">collapse</span>()</code> is more flexible and faster as well.</p>
</div>
<div id="sec:collapse" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:collapse" class="anchor"></a><span class="header-section-number">5.2</span> Binding Objects that do not Share the Same Extra Data and/or Wavelength Axis</h2>

<p>Function <code class="sourceCode r"><span class="kw">collapse</span>()</code> combines objects that should be bound together by row, but they do not share the columns and/or spectral range.
The resulting object has all columns from all input objects, and all wavelengths from the input objects.
If an input object does not have a particular column or wavelength, its value in the resulting object is <code class="sourceCode r"><span class="ot">NA</span></code>.</p>
<p>The <code class="sourceCode r">barbiturates</code> data is a list of 5 <code class="sourceCode r">hyperSpec</code> objects, each containing one mass spectrum.
The spectra have between 22 and 37 data points each.</p>
<div class="sourceCode" id="cb61"><pre class="downlit">
<span class="kw">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse.html">collapse</a></span>(<span class="kw">barbiturates</span>)
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">barb</span>)[<span class="fl">1</span><span class="op">:</span><span class="fl">25</span>]
<span class="co">#&gt;  [1] 27.05 27.15 28.05 28.15 29.05 30.05 30.15 31.15 32.15 38.90 39.00 40.00 40.10 41.10 43.05 43.85</span>
<span class="co">#&gt; [17] 43.95 44.05 55.00 55.10 56.00 56.10 57.00 57.10 68.90</span>
</pre></div>
<p>The resulting object does not have an ordered wavelength axis.
This can be obtained in the second step:</p>
<div class="sourceCode" id="cb62"><pre class="downlit">
<span class="kw">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orderwl.html">orderwl</a></span>(<span class="kw">barb</span>)
<span class="kw">barb</span>[[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="kw">min</span> <span class="op">~</span> <span class="kw">min</span> <span class="op">+</span> <span class="fl">10i</span>]]
<span class="co">#&gt;      27.05 27.15 28.05 28.15 29.05 30.05 30.15 31.15 32.15 38.9  39</span>
<span class="co">#&gt; [1,]   562    NA    NA 11511  6146  1253    NA  9851 10751   NA 756</span>
<span class="co">#&gt; [2,]    NA   618 10151    NA  5040    NA   910  8200 10989   NA 770</span>
<span class="co">#&gt; [3,]   638    NA    NA 10722  5253   966    NA  8709 10899   NA  NA</span>
</pre></div>
</div>
<div id="sec:merge" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:merge" class="anchor"></a><span class="header-section-number">5.3</span> Binding Objects that do not Share the Same Spectra</h2>

<p>Function <code class="sourceCode r"><span class="kw">merge</span>()</code> adds a new spectral range (like <code class="sourceCode r"><span class="kw">cbind</span>()</code>), but works also if spectra are missing in one of the objects.
The arguments <code class="sourceCode r">by</code>, <code class="sourceCode r">by.x</code>, and <code class="sourceCode r">by.y</code> specify which columns should be used to decide which spectra are the same.
The arguments <code class="sourceCode r">all</code>, <code class="sourceCode r">all.x</code>, and <code class="sourceCode r">all.y</code> determine whether spectra should be kept for the result set if they appear in only one of the objects.
For details, see also the help on the base function <code class="sourceCode r"><span class="kw">merge</span>()</code>.</p>
<p>As an example, let’s construct a version of the <code class="sourceCode r">chondro</code> data like being taken as two maps with different spectral ranges.
In each data set, some spectra are missing.</p>
<div class="sourceCode" id="cb63"><pre class="downlit">
<span class="kw">chondro.low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw">chondro</span>[, , <span class="fl">600</span> <span class="op">~</span> <span class="fl">1200</span>], <span class="fl">700</span>)
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro.low</span>)
<span class="co">#&gt; [1] 700</span>
</pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit">
<span class="kw">chondro.high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="kw">chondro</span>[, , <span class="fl">1400</span> <span class="op">~</span> <span class="fl">1800</span>], <span class="fl">700</span>)
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro.high</span>)
<span class="co">#&gt; [1] 700</span>
</pre></div>
<p>As all extra data columns are the same, no special declarations are needed for merging the data:</p>
<div class="sourceCode" id="cb65"><pre class="downlit">
<span class="kw">chondro.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">chondro.low</span>, <span class="kw">chondro.high</span>)
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro.merged</span>)
<span class="co">#&gt; [1] 553</span>
</pre></div>
<p>By default, the result consists of only those spectra, where <em>both</em> spectral ranges were available.
To keep all spectra replacing missing parts by <code class="sourceCode r"><span class="ot">NA</span></code> (see Fig. <a href="#fig:merge-map">5.1</a>, <a href="#fig:merge-mat">5.2</a>):</p>
<div class="sourceCode" id="cb66"><pre class="downlit">
<span class="kw">chondro.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">chondro.low</span>, <span class="kw">chondro.high</span>, all = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro.merged</span>)
<span class="co">#&gt; [1] 847</span>
</pre></div>
<div class="sourceCode" id="cb67"><pre class="downlit">
<span class="fu">levelplot</span>(<span class="kw">spc</span> <span class="op">~</span> <span class="kw">x</span> <span class="op">*</span> <span class="kw">y</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="kw">.wavelength</span>, <span class="st">"  1/cm"</span>)),
  <span class="kw">chondro.merged</span>[, , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1000</span>, <span class="fl">1650</span>)],
  aspect = <span class="st">"iso"</span>, col.regions = <span class="fu"><a href="../reference/matlab.palette.html">matlab.palette</a></span>()
)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:merge-map"></span>
<img src="hyperSpec_files/figure-html/merge-map-1.png" alt="For both spectral ranges some spectra are missing. "><p class="caption">
Figure 5.1: For both spectral ranges some spectra are missing.
</p>
</div>
<!-- ```{r merge-mat echo=FALSE, results='hide'} -->
<!-- png("hyperspec-fig-merged.png", width = 500, height = 425, res = 100) -->
<!-- plot(chondro.merged[1:100], "mat") -->
<!-- dev.off() -->
<!-- rm(chondro) -->
<!-- ``` -->
<div class="sourceCode" id="cb68"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">chondro.merged</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">100</span>], <span class="st">"mat"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:merge-mat"></span>
<img src="hyperSpec_files/figure-html/merge-mat-1.png" alt="The missing parts of the spectra are filled with `NA`{.r}.  "><p class="caption">
Figure 5.2: The missing parts of the spectra are filled with <code class="sourceCode r"><span class="ot">NA</span></code>.
</p>
</div>
<div class="sourceCode" id="cb69"><pre class="downlit">
<span class="kw">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">chondro</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, , <span class="fl">610</span> <span class="op">~</span> <span class="fl">620</span>], <span class="kw">chondro</span>[<span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, , <span class="fl">615</span> <span class="op">~</span> <span class="fl">625</span>], all = <span class="fl">TRUE</span>)
<span class="kw">merged</span><span class="op">$</span><span class="kw">.</span>
<span class="co">#&gt;        y      x            filename clusters .nx .ny  spc.1  spc.2  spc.3  spc.4  spc.5  spc.6</span>
<span class="co">#&gt; 1  -4.77 -11.55 rawdata/chondro.txt   matrix   1  NA 488.63 466.18 492.00     NA     NA     NA</span>
<span class="co">#&gt; 2  -4.77 -10.55 rawdata/chondro.txt   matrix   2  NA 489.48 465.05 490.53     NA     NA     NA</span>
<span class="co">#&gt; 3  -4.77  -9.55 rawdata/chondro.txt   matrix   3  NA 456.03 436.62 458.06     NA     NA     NA</span>
<span class="co">#&gt; 4  -4.77  -8.55 rawdata/chondro.txt   matrix   4  NA 464.82 444.85 470.02     NA     NA     NA</span>
<span class="co">#&gt; 5  -4.77  -7.55 rawdata/chondro.txt   matrix   5   1 428.66 410.80 433.12 410.80 433.12 461.19</span>
<span class="co">#&gt; 6  -4.77  -6.55 rawdata/chondro.txt   matrix   6   2 426.07 407.86 431.21 407.86 431.21 458.15</span>
<span class="co">#&gt; 7  -4.77  -5.55 rawdata/chondro.txt   lacuna   7   3 412.37 396.50 421.27 396.50 421.27 445.54</span>
<span class="co">#&gt; 8  -4.77  -4.55 rawdata/chondro.txt   lacuna  NA   4     NA     NA     NA 381.95 406.25 429.67</span>
<span class="co">#&gt; 9  -4.77  -3.55 rawdata/chondro.txt   lacuna  NA   5     NA     NA     NA 397.51 423.30 446.15</span>
<span class="co">#&gt; 10 -4.77  -2.55 rawdata/chondro.txt   lacuna  NA   6     NA     NA     NA 377.39 402.23 424.19</span>
<span class="co">#&gt;     spc.7</span>
<span class="co">#&gt; 1      NA</span>
<span class="co">#&gt; 2      NA</span>
<span class="co">#&gt; 3      NA</span>
<span class="co">#&gt; 4      NA</span>
<span class="co">#&gt; 5  397.38</span>
<span class="co">#&gt; 6  394.18</span>
<span class="co">#&gt; 7  382.72</span>
<span class="co">#&gt; 8  368.46</span>
<span class="co">#&gt; 9  381.87</span>
<span class="co">#&gt; 10 362.43</span>
</pre></div>
<p>If the spectra overlap, the result will have both data points.
In the example here one could easily delete duplicate wavelengths.
For real data, however, the duplicated wavelength will hardly ever contain the same values.
The appropriate method to deal with this situation depends on the data at hand, but it will usually be some kind of spectral interpolation.</p>
<p>One possibility is removing duplicated wavelengths by using the mean intensity.
This can conveniently be done by using <code class="sourceCode r"><span class="kw">approx</span>()</code> using <code class="sourceCode r">method =<span class="st"> "constant"</span></code>.
For duplicated wavelengths, the intensities will be combined by the tie function.
This already defaults to the mean, but we need <code class="sourceCode r">na.rm =<span class="st"> </span><span class="ot">TRUE</span></code>.</p>
<p>Thus, the function to calculate the new spectral intensities is</p>
<div class="sourceCode" id="cb70"><pre class="downlit">
<span class="kw">approxfun</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">y</span>, <span class="kw">wl</span>, <span class="kw">new.wl</span>) {
  <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html">approx</a></span>(<span class="kw">wl</span>, <span class="kw">y</span>, <span class="kw">new.wl</span>,
    method = <span class="st">"constant"</span>,
    ties = <span class="fu">function</span>(<span class="kw">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">x</span>, na.rm = <span class="fl">TRUE</span>)
  )<span class="op">$</span><span class="kw">y</span>
}
</pre></div>
<p>which can be applied to the spectra:</p>
<div class="sourceCode" id="cb71"><pre class="downlit">
<span class="kw">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">merged</span>, <span class="fl">1</span>, <span class="kw">approxfun</span>,
  wl = <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">merged</span>),
  new.wl = <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">merged</span>)),
  new.wavelength = <span class="st">"new.wl"</span>
)
<span class="kw">merged</span><span class="op">$</span><span class="kw">.</span>
<span class="co">#&gt;        y      x            filename clusters .nx .ny  spc.1  spc.2  spc.3  spc.4  spc.5</span>
<span class="co">#&gt; 1  -4.77 -11.55 rawdata/chondro.txt   matrix   1  NA 488.63 466.18 492.00     NA     NA</span>
<span class="co">#&gt; 2  -4.77 -10.55 rawdata/chondro.txt   matrix   2  NA 489.48 465.05 490.53     NA     NA</span>
<span class="co">#&gt; 3  -4.77  -9.55 rawdata/chondro.txt   matrix   3  NA 456.03 436.62 458.06     NA     NA</span>
<span class="co">#&gt; 4  -4.77  -8.55 rawdata/chondro.txt   matrix   4  NA 464.82 444.85 470.02     NA     NA</span>
<span class="co">#&gt; 5  -4.77  -7.55 rawdata/chondro.txt   matrix   5   1 428.66 410.80 433.12 461.19 397.38</span>
<span class="co">#&gt; 6  -4.77  -6.55 rawdata/chondro.txt   matrix   6   2 426.07 407.86 431.21 458.15 394.18</span>
<span class="co">#&gt; 7  -4.77  -5.55 rawdata/chondro.txt   lacuna   7   3 412.37 396.50 421.27 445.54 382.72</span>
<span class="co">#&gt; 8  -4.77  -4.55 rawdata/chondro.txt   lacuna  NA   4     NA 381.95 406.25 429.67 368.46</span>
<span class="co">#&gt; 9  -4.77  -3.55 rawdata/chondro.txt   lacuna  NA   5     NA 397.51 423.30 446.15 381.87</span>
<span class="co">#&gt; 10 -4.77  -2.55 rawdata/chondro.txt   lacuna  NA   6     NA 377.39 402.23 424.19 362.43</span>
</pre></div>
</div>
<div id="sec:merge-df" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:merge-df" class="anchor"></a><span class="header-section-number">5.4</span> Merging extra data to objects that do not (necessarily) share the same spectra</h2>
<p>Assume we obtained duplicate reference measurements for some of the concentrations in <code class="sourceCode r">flu</code>:</p>
<div class="sourceCode" id="cb72"><pre class="downlit">
<span class="kw">flu.ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  filename = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">flu</span><span class="op">$</span><span class="kw">filename</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], each = <span class="fl">2</span>),
  cref = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw">flu</span><span class="op">$</span><span class="kw">c</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">2</span>], each = <span class="fl">2</span>) <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fl">4</span>, sd = <span class="fl">0.01</span>)
)
<span class="kw">flu.ref</span>
<span class="co">#&gt;           filename     cref</span>
<span class="co">#&gt; 1 rawdata/flu1.txt 0.045013</span>
<span class="co">#&gt; 2 rawdata/flu1.txt 0.052173</span>
<span class="co">#&gt; 3 rawdata/flu2.txt 0.104047</span>
<span class="co">#&gt; 4 rawdata/flu2.txt 0.103288</span>
</pre></div>
<p>This information can be merged into the extra data of <code class="sourceCode r">flu</code> by:</p>
<div class="sourceCode" id="cb73"><pre class="downlit">
<span class="kw">flu.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">flu</span>, <span class="kw">flu.ref</span>)
<span class="kw">flu.merged</span><span class="op">$</span><span class="kw">..</span>
<span class="co">#&gt;           filename    c     cref</span>
<span class="co">#&gt; 1 rawdata/flu1.txt 0.05 0.045013</span>
<span class="co">#&gt; 2 rawdata/flu1.txt 0.05 0.052173</span>
<span class="co">#&gt; 3 rawdata/flu2.txt 0.10 0.104047</span>
<span class="co">#&gt; 4 rawdata/flu2.txt 0.10 0.103288</span>
</pre></div>
<p>The usual rules for <code class="sourceCode r"><span class="kw">merge</span>()</code> apply.
E. g., if to preserver all spectra of flu, use <code class="sourceCode r">all.x =<span class="st"> </span><span class="ot">TRUE</span></code>:</p>
<div class="sourceCode" id="cb74"><pre class="downlit">
<span class="kw">flu.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">flu</span>, <span class="kw">flu.ref</span>, all.x = <span class="fl">TRUE</span>)
<span class="kw">flu.merged</span><span class="op">$</span><span class="kw">..</span>
<span class="co">#&gt;           filename    c     cref</span>
<span class="co">#&gt; 1 rawdata/flu1.txt 0.05 0.045013</span>
<span class="co">#&gt; 2 rawdata/flu1.txt 0.05 0.052173</span>
<span class="co">#&gt; 3 rawdata/flu2.txt 0.10 0.104047</span>
<span class="co">#&gt; 4 rawdata/flu2.txt 0.10 0.103288</span>
<span class="co">#&gt; 5 rawdata/flu3.txt 0.15       NA</span>
<span class="co">#&gt; 6 rawdata/flu4.txt 0.20       NA</span>
<span class="co">#&gt; 7 rawdata/flu5.txt 0.25       NA</span>
<span class="co">#&gt; 8 rawdata/flu6.txt 0.30       NA</span>
</pre></div>
<p>The class of the first object (<code class="sourceCode r">x</code>) determines the resulting class:</p>
<div class="sourceCode" id="cb75"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">flu</span>, <span class="kw">flu.ref</span>))
<span class="co">#&gt; [1] "hyperSpec"</span>
<span class="co">#&gt; attr(,"package")</span>
<span class="co">#&gt; [1] "hyperSpec"</span>
</pre></div>
<div class="sourceCode" id="cb76"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="fu"><a href="../reference/merge,hyperSpec,hyperSpec-method.html">merge</a></span>(<span class="kw">flu.ref</span>, <span class="kw">flu</span>))
<span class="co">#&gt; [1] "data.frame"</span>
</pre></div>
</div>
<div id="sec:matmult" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:matmult" class="anchor"></a><span class="header-section-number">5.5</span> Matrix Multiplication</h2>

<p>Two <code class="sourceCode r">hyperSpec</code> objects can be matrix multiplied by <code class="sourceCode r"><span class="op">%*%</span></code>.
For an example, see the principal component analysis below (section <a href="#sec:pca">8.1</a>).</p>
</div>
<div id="sec:decomposition" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:decomposition" class="anchor"></a><span class="header-section-number">5.6</span> Decomposition</h2>
<p>Matrix decompositions are common operations during chemometric data analysis.
The results, e.g., of a principal component analysis are two matrices, the so-called scores and loadings.
The results can have either the same number of rows as the spectra matrix they were calculated from (scores-like), or
they have as many wavelengths as the spectra (loadings-like).</p>

<p>Both types of result objects can be “re-imported” into <code class="sourceCode r">hyperSpec</code> objects with function <code class="sourceCode r"><span class="kw">decomposition</span>()</code>.
A scores-like object retains all per-spectrum information (i.e., the extra data) while the spectra matrix and wavelength vector are replaced.
A loadings-like object retains the wavelength information, while extra data is deleted (set to <code class="sourceCode r"><span class="ot">NA</span></code>) unless the value is constant for all spectra.</p>
<p>A demonstration can be found in the principal component analysis example (section <a href="#sec:pca">8.1</a>).</p>
</div>
</div>
<div id="plotting-hyperspec" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-hyperspec" class="anchor"></a><span class="header-section-number">6</span> Plotting</h1>
<p>Package <strong>hyperSpec</strong> offers a variety of possibilities to plot spectra, spectral maps, the spectra matrix, time
series, depth profiles, etc.
This all is discussed in a separate document: see <code><a href="../articles/plotting.html">vignette ("plotting")</a></code>.</p>
</div>
<div id="spectral-preprocessing" class="section level1">
<h1 class="hasAnchor">
<a href="#spectral-preprocessing" class="anchor"></a><span class="header-section-number">7</span> Spectral (Pre)processing</h1>
<div id="cutting-the-spectral-range" class="section level2">
<h2 class="hasAnchor">
<a href="#cutting-the-spectral-range" class="anchor"></a><span class="header-section-number">7.1</span> Cutting the Spectral Range</h2>

<p>The extraction operators <code>[]</code> and <code>[[]]</code> can be used to cut the spectra.
Their third argument takes wavelength specifications as discussed above and also logicals (i.e. vectors specifying with <code class="sourceCode r"><span class="ot">TRUE</span></code>/<code class="sourceCode r"><span class="ot">FALSE</span></code> for each column of <code class="sourceCode r"><span class="op">$</span>spc</code> whether it should be included or not.</p>
<p>Operator<code>[]</code> returns a <code class="sourceCode r">hyperSpec</code> object, <code>[[]]</code> the spectra matrix <code class="sourceCode r"><span class="op">$</span>spc</code> (or the <code class="sourceCode r">data.frame</code> <code class="sourceCode r"><span class="op">@</span>data</code> if in addition data columns were specified) only.</p>
<div class="sourceCode" id="cb77"><pre class="downlit">
<span class="kw">flu</span>[, , <span class="kw">min</span> <span class="op">~</span> <span class="fl">408.5</span>]
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    6 spectra</span>
<span class="co">#&gt;    3 data columns</span>
<span class="co">#&gt;    8 data points / spectrum</span>
<span class="co">#&gt; wavelength: lambda/nm [numeric] 405.0 405.5 ... 408.5 </span>
<span class="co">#&gt; data:  (6 rows x 3 columns)</span>
<span class="co">#&gt;    1. spc: I[fl]/"a.u." [matrix, array8] 27.150 66.801 ... 256.89 </span>
<span class="co">#&gt;    2. filename: filename [character] rawdata/flu1.txt rawdata/flu2.txt ... rawdata/flu6.txt </span>
<span class="co">#&gt;    3. c: c / (mg / l) [numeric] 0.05 0.10 ... 0.3</span>
<span class="kw">flu</span>[[, , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">min</span> <span class="op">~</span> <span class="kw">min</span> <span class="op">+</span> <span class="fl">2i</span>, <span class="kw">max</span> <span class="op">-</span> <span class="fl">2i</span> <span class="op">~</span> <span class="kw">max</span>)]]
<span class="co">#&gt;          405   405.5     406     494   494.5     495</span>
<span class="co">#&gt; [1,]  27.150  32.345  33.379  47.163  46.412  45.256</span>
<span class="co">#&gt; [2,]  66.801  63.715  66.712  96.602  96.206  94.610</span>
<span class="co">#&gt; [3,]  93.144 103.068 106.194 149.539 148.527 145.793</span>
<span class="co">#&gt; [4,] 130.664 139.998 143.798 201.484 198.867 195.867</span>
<span class="co">#&gt; [5,] 167.267 171.898 177.471 252.066 248.067 246.952</span>
<span class="co">#&gt; [6,] 198.430 209.458 215.785 307.519 302.325 294.649</span>
</pre></div>
</div>
<div id="sec:shifting-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:shifting-spectra" class="anchor"></a><span class="header-section-number">7.2</span> Shifting Spectra</h2>
<p>Sometimes, spectra need to be aligned along the spectral axis.</p>
<p>In general, two options are available for shifting spectra along the wavelength axis.</p>
<ol style="list-style-type: decimal">
<li>The wavelength axis can be shifted, while the intensities stay unaffected.</li>
<li>The spectra are interpolated onto a new wavelength axis, while the nominal wavelengths stay.</li>
</ol>
<p>The first method is very straightforward (Fig. <a href="#fig:shift-wl">7.1</a>):</p>
<div class="sourceCode" id="cb78"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>) <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>) <span class="op">-</span> <span class="fl">10</span>
</pre></div>
<div class="sourceCode" id="cb79"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">chondro</span>[<span class="fl">135</span>])
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">tmp</span>[<span class="fl">135</span>, , ], add = <span class="fl">TRUE</span>, col = <span class="st">"red"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:shift-wl"></span>
<img src="hyperSpec_files/figure-html/shift-wl-1.png" alt="Shifting the spectra along the wavelength axis: changing the wavelength values.  "><p class="caption">
Figure 7.1: Shifting the spectra along the wavelength axis: changing the wavelength values.
</p>
</div>
<p>But the method cannot be used if each spectrum (or groups of spectra) are shifted individually.
In that case, interpolation is needed.
<code>R</code> offers many possibilities to interpolate (e.g., <code class="sourceCode r"><span class="kw">approx</span>()</code> for constant / linear approximation, <code class="sourceCode r"><span class="kw">spline</span>()</code> for spline interpolation, <code class="sourceCode r"><span class="kw">loess</span>()</code> can be used to obtain smoothed approximations, etc.).
The appropriate interpolation strategy will depend on the spectra, and package <strong>hyperSpec</strong> therefore leaves it up to the user to select a sensible interpolation function.</p>
<p>As an example, we will use natural splines to do the interpolation.
It is convenient to set it up as a function:</p>
<div class="sourceCode" id="cb80"><pre class="downlit">
<span class="kw">interpolate</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">spc</span>, <span class="kw">shift</span>, <span class="kw">wl</span>) {
  <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">spline</a></span>(<span class="kw">wl</span> <span class="op">+</span> <span class="kw">shift</span>, <span class="kw">spc</span>, xout = <span class="kw">wl</span>, method = <span class="st">"natural"</span>)<span class="op">$</span><span class="kw">y</span>
}
</pre></div>
<p>This function can now be applied to a set of spectra (Fig. <a href="#fig:shift-interp">7.2</a>):</p>
<div class="sourceCode" id="cb81"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">interpolate</span>, shift = <span class="op">-</span><span class="fl">10</span>, wl = <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">chondro</span>))
</pre></div>
<div class="sourceCode" id="cb82"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">chondro</span>[<span class="fl">135</span>])
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">tmp</span>[<span class="fl">135</span>], add = <span class="fl">TRUE</span>, col = <span class="st">"red"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:shift-interp"></span>
<img src="hyperSpec_files/figure-html/shift-interp-1.png" alt="Shifting the spectra along the wavelength axis: interpolation.  "><p class="caption">
Figure 7.2: Shifting the spectra along the wavelength axis: interpolation.
</p>
</div>
<p>Fig. <a href="#fig:shift-untsch">7.3</a> demonstrates the difference between simple shifting and interpolation.</p>
<div class="sourceCode" id="cb83"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">135</span>, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1010</span>]
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">tmp</span>, lines.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(type = <span class="st">"b"</span>, pch = <span class="fl">19</span>, cex = <span class="fl">0.5</span>))
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>) <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>) <span class="op">-</span> <span class="fl">0.5</span>
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">tmp</span>, lines.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(type = <span class="st">"b"</span>, pch = <span class="fl">19</span>, cex = <span class="fl">0.5</span>), add = <span class="fl">TRUE</span>, col = <span class="st">"red"</span>)

<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">135</span>]
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">tmp</span>, <span class="fl">1</span>, <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">wl</span>, <span class="kw">shift</span>) {
  <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">spline</a></span>(<span class="kw">wl</span> <span class="op">+</span> <span class="kw">shift</span>, <span class="kw">x</span>, xout = <span class="kw">wl</span>)<span class="op">$</span><span class="kw">y</span>
},
wl = <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>), shift = <span class="op">-</span><span class="fl">0.5</span>
)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">tmp</span>, lines.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(type = <span class="st">"b"</span>, pch = <span class="fl">19</span>, cex = <span class="fl">0.5</span>), add = <span class="fl">TRUE</span>, col = <span class="st">"blue"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:shift-untsch"></span>
<img src="hyperSpec_files/figure-html/shift-untsch-1.png" alt="Shifting the spectra along the wavelength axis.
Detail view of the phenylalanine band: shifting by `wl&lt;-`{.r} (red) does not affect the intensities, while the spectrum is slightly changed by interpolations (blue).  "><p class="caption">
Figure 7.3: Shifting the spectra along the wavelength axis.
Detail view of the phenylalanine band: shifting by <code class="sourceCode r">wl&lt;-</code> (red) does not affect the intensities, while the spectrum is slightly changed by interpolations (blue).
</p>
</div>
<p>If different spectra need to be offset by different shift, use a loop<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb84"><pre class="downlit">
<span class="kw">shifts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>))
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[[]]
<span class="co">for</span> (<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>))) {
  <span class="kw">tmp</span>[<span class="kw">i</span>, ] <span class="op">&lt;-</span> <span class="fu">interpolate</span>(<span class="kw">tmp</span>[<span class="kw">i</span>, ], <span class="kw">shifts</span>[<span class="kw">i</span>], wl = <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">chondro</span>))
}
<span class="kw">chondro</span>[[]] <span class="op">&lt;-</span> <span class="kw">tmp</span>
</pre></div>
<div id="sec:calculating-shift" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:calculating-shift" class="anchor"></a><span class="header-section-number">7.2.1</span> Calculating the Shift</h3>
<p>Often, the shift in the spectra is determined by aligning a particular signal.
This strategy works best with spectrally oversampled data that allows accurate determination of the signal position.</p>
<p>For the <code class="sourceCode r">chondro</code> data, let’s use the maximum of the phenylalanine band between 990 and 1020 cm<sup>-1</sup>.
As just the very maximum is too coarse, we’ll use the maximum of a square polynomial fitted to the maximum and its two neighbours.</p>
<div class="sourceCode" id="cb85"><pre class="downlit">
<span class="co">#  TODO: use vanderMonde</span>
</pre></div>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
<div class="sourceCode" id="cb86"><pre class="downlit">
<span class="kw">find.max</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">y</span>, <span class="kw">x</span>) {
  <span class="kw">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span>(<span class="kw">y</span>) <span class="op">+</span> (<span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span>)
  <span class="kw">X</span> <span class="op">&lt;-</span> <span class="kw">x</span>[<span class="kw">pos</span>] <span class="op">-</span> <span class="kw">x</span>[<span class="kw">pos</span>[<span class="fl">2</span>]]
  <span class="kw">Y</span> <span class="op">&lt;-</span> <span class="kw">y</span>[<span class="kw">pos</span>] <span class="op">-</span> <span class="kw">y</span>[<span class="kw">pos</span>[<span class="fl">2</span>]]

  <span class="kw">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="kw">X</span>, <span class="kw">X</span><span class="op">^</span><span class="fl">2</span>)
  <span class="kw">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/qr.html">qr.solve</a></span>(<span class="kw">X</span>, <span class="kw">Y</span>)

  <span class="op">-</span><span class="kw">coef</span>[<span class="fl">2</span>] <span class="op">/</span> <span class="kw">coef</span>[<span class="fl">3</span>] <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="kw">x</span>[<span class="kw">pos</span>[<span class="fl">2</span>]]
}

<span class="kw">bandpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">chondro</span>[[, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1020</span>]], <span class="fl">1</span>, <span class="kw">find.max</span>, <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">chondro</span>[, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1020</span>]))
<span class="kw">refpos</span> <span class="op">&lt;-</span> <span class="fu">find.max</span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="kw">chondro</span>[[, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1020</span>]]), <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">chondro</span>[, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1020</span>]))

<span class="kw">shift1</span> <span class="op">&lt;-</span> <span class="kw">refpos</span> <span class="op">-</span> <span class="kw">bandpos</span>
</pre></div>
<p>A second possibility is to optimize the shift.
For this strategy, the spectra must be sufficiently similar, while low spectral resolution is compensated by using larger spectral windows.</p>
<div class="sourceCode" id="cb87"><pre class="downlit">
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="kw">chondro</span> <span class="op">-</span> <span class="fu"><a href="../reference/spc.fit.poly.html">spc.fit.poly.below</a></span>(<span class="kw">chondro</span>[, , <span class="kw">min</span> <span class="op">+</span> <span class="fl">3i</span> <span class="op">~</span> <span class="kw">max</span> <span class="op">-</span> <span class="fl">3i</span>], <span class="kw">chondro</span>)
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="kw">chondro</span>[[]], na.rm = <span class="fl">TRUE</span>), <span class="st">"/"</span>)
</pre></div>
<div class="sourceCode" id="cb88"><pre class="downlit">
<span class="kw">targetfn</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">shift</span>, <span class="kw">wl</span>, <span class="kw">spc</span>, <span class="kw">targetspc</span>) {
  <span class="kw">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html">spline</a></span>(<span class="kw">wl</span> <span class="op">+</span> <span class="kw">shift</span>, <span class="kw">spc</span>, xout = <span class="kw">wl</span>)<span class="op">$</span><span class="kw">y</span> <span class="op">-</span> <span class="kw">targetspc</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">error</span><span class="op">^</span><span class="fl">2</span>)
}

<span class="kw">shift2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>))
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[[]]
<span class="kw">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span>(<span class="kw">chondro</span>[[]])
<span class="co">for</span> (<span class="kw">i</span> <span class="co">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>)) {
  <span class="kw">shift2</span>[<span class="kw">i</span>] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/optimize.html">optimize</a></span>(<span class="kw">targetfn</span>,
    interval = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>),
    wl = <span class="kw">chondro</span><span class="op">@</span>wavelength,
    spc = <span class="kw">tmp</span>[<span class="kw">i</span>, ], targetspc = <span class="kw">target</span>
  )<span class="op">$</span><span class="kw">minimum</span>)
}
</pre></div>
<p>Figure <a href="#fig:fit-shift">7.4</a> shows that the second correction method works better for the chondrocyte data.
This was expected, as the spectra are hardly or not oversampled, but are very similar to each other.</p>
<div class="sourceCode" id="cb89"><pre class="downlit">
<span class="kw">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  shift = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">shifts</span>, <span class="kw">shifts</span> <span class="op">+</span> <span class="kw">shift1</span>, <span class="kw">shifts</span> <span class="op">+</span> <span class="kw">shift2</span>),
  method = <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"original"</span>, <span class="st">"find maximum"</span>, <span class="st">"interpolation"</span>),
    each = <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">chondro</span>)
  )
)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="fu">histogram</span>(<span class="op">~</span> <span class="kw">shift</span> <span class="op">|</span> <span class="kw">method</span>,
  data = <span class="kw">df</span>, breaks = <span class="fu">do.breaks</span>(<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw">df</span><span class="op">$</span><span class="kw">shift</span>), <span class="fl">25</span>),
  layout = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>, <span class="fl">1</span>)
))
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:fit-shift"></span>
<img src="hyperSpec_files/figure-html/fit-shift-1.png" alt="The shifts used to disturb the chondrocyte data (original), and the remaining shift after correction with the two methods discussed here.  "><p class="caption">
Figure 7.4: The shifts used to disturb the chondrocyte data (original), and the remaining shift after correction with the two methods discussed here.
</p>
</div>
</div>
</div>
<div id="removing-bad-data" class="section level2">
<h2 class="hasAnchor">
<a href="#removing-bad-data" class="anchor"></a><span class="header-section-number">7.3</span> Removing Bad Data</h2>
<div id="sec:bad-spectra" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:bad-spectra" class="anchor"></a><span class="header-section-number">7.3.1</span> Bad Spectra</h3>
<p>Occasionally, one may want to remove spectra because of too low or too high signal.
E.g., for infrared spectra one may state that the absorbance maximum should be, say, between 0.1 and 1.
Class <code class="sourceCode r">hyperSpec</code>’s comparison operators return a logical matrix of the size of the spectra that is suitable for later indexing:</p>
<div class="sourceCode" id="cb90"><pre class="downlit">
<span class="kw">ir.spc</span> <span class="op">&lt;-</span> <span class="kw">chondro</span> <span class="op">/</span> <span class="fl">1500</span> <span class="co">## fake IR data</span>
<span class="kw">high.int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">ir.spc</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="kw">any</span>) <span class="co"># any point above 1 is bad</span>
<span class="kw">low.int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">ir.spc</span>, <span class="fl">1</span>, <span class="kw">max</span>) <span class="op">&lt;</span> <span class="fl">0.1</span> <span class="co"># the maximum should be at least 0.1</span>
<span class="kw">ir.spc</span> <span class="op">&lt;-</span> <span class="kw">ir.spc</span> [<span class="op">!</span><span class="kw">high.int</span> <span class="op">&amp;</span> <span class="op">!</span><span class="kw">low.int</span>]
</pre></div>
</div>
<div id="removing-spectra-outside-mean-pm-n-sd" class="section level3">
<h3 class="hasAnchor">
<a href="#removing-spectra-outside-mean-pm-n-sd" class="anchor"></a><span class="header-section-number">7.3.2</span> Removing Spectra outside mean <span class="math inline">\(\pm\)</span> <span class="math inline">\(n\)</span> sd</h3>
<div class="sourceCode" id="cb91"><pre class="downlit">
<span class="kw">mean_sd_filter</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">x</span>, <span class="kw">n</span> = <span class="fl">5</span>) {
  <span class="kw">x</span> <span class="op">&lt;-</span> <span class="kw">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="kw">x</span>)
  <span class="kw">s</span> <span class="op">&lt;-</span> <span class="kw">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="kw">x</span>)
  (<span class="kw">x</span> <span class="op">&lt;=</span> <span class="kw">s</span>) <span class="op">&amp;</span> (<span class="kw">x</span> <span class="op">&gt;</span> <span class="op">-</span><span class="kw">s</span>)
}

<span class="kw">OK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">chondro</span>[[]], <span class="fl">2</span>, <span class="kw">mean_sd_filter</span>, n = <span class="fl">4</span>) <span class="co"># logical matrix</span>

<span class="kw">spc.OK</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">OK</span>, <span class="fl">1</span>, <span class="kw">all</span>)]
</pre></div>
<div class="sourceCode" id="cb92"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">chondro</span>[<span class="op">!</span><span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">OK</span>, <span class="fl">1</span>, <span class="kw">all</span>)])
<span class="kw">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="op">!</span><span class="kw">OK</span>, arr.ind = <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">chondro</span>)[<span class="kw">i</span>[, <span class="fl">2</span>]], <span class="kw">chondro</span>[[<span class="op">!</span><span class="kw">OK</span>]], pch = <span class="fl">19</span>, col = <span class="st">"red"</span>, cex = <span class="fl">0.5</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:filter"></span>
<img src="hyperSpec_files/figure-html/filter-1.png" alt="Filtering data: mean $\pm$ sd filter.  "><p class="caption">
Figure 7.5: Filtering data: mean <span class="math inline">\(\pm\)</span> sd filter.
</p>
</div>
<!-- \begin{figure}[tb] -->
<!--   \subfloat[]{\includegraphics[width=0.49\textwidth]{hyperspec-fig-filter}} -->
<!--   \subfloat[remove bad points]{\includegraphics[width=0.49\textwidth]{hyperspec-fig-bad}} -->
<!--   \caption{filtering data} -->
<!--    {#fig:filter} -->
<!-- \end{figure} -->
</div>
<div id="sec:bad-data-points" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:bad-data-points" class="anchor"></a><span class="header-section-number">7.3.3</span> Bad Data Points</h3>
<p>Assume the data contains once in a while a detector readout of 0:</p>
<div class="sourceCode" id="cb93"><pre class="downlit">
<span class="kw">spc</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="kw">min</span> <span class="op">~</span> <span class="kw">min</span> <span class="op">+</span> <span class="fl">15i</span>]
<span class="kw">spc</span>[[<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="../reference/ncol,hyperSpec-method.html">nwl</a></span>(<span class="kw">spc</span>), <span class="fl">3</span>)), wl.index = <span class="fl">TRUE</span>]] <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="kw">spc</span>[[]]
<span class="co">#&gt;           602     606      610      614     618     622        626       630       634        638</span>
<span class="co">#&gt; [1,] 0.104091 0.10782 0.068269 0.030381 0.10149 0.00000 -0.0128717 -0.046818 -0.052313 -0.0091329</span>
<span class="co">#&gt; [2,] 0.099926 0.10908 0.000000 0.029108 0.10156 0.13821 -0.0153190 -0.049986 -0.054980 -0.0056902</span>
<span class="co">#&gt; [3,] 0.092908 0.11303 0.074029 0.033669 0.08212 0.15252  0.0070972 -0.050008 -0.057566  0.0000000</span>
<span class="co">#&gt;           642      646         650       654       658      662</span>
<span class="co">#&gt; [1,] 0.072297 0.020927  8.8598e-04 0.0088217 0.0111474 0.018159</span>
<span class="co">#&gt; [2,] 0.073731 0.024613 -1.3476e-03 0.0080903 0.0118944 0.020616</span>
<span class="co">#&gt; [3,] 0.070407 0.035170  1.8805e-05 0.0059341 0.0077598 0.015426</span>
</pre></div>
<p>We can set these points to <code class="sourceCode r"><span class="ot">NA</span></code>, again using that the comparison returns a suitable logical matrix:</p>
<div class="sourceCode" id="cb94"><pre class="downlit">
<span class="kw">spc</span>[[<span class="kw">spc</span> <span class="op">&lt;</span> <span class="fl">1e-4</span>]] <span class="op">&lt;-</span> <span class="fl">NA</span>
<span class="kw">spc</span>[[]]
<span class="co">#&gt;           602     606      610      614     618     622       626 630 634 638      642      646</span>
<span class="co">#&gt; [1,] 0.104091 0.10782 0.068269 0.030381 0.10149      NA        NA  NA  NA  NA 0.072297 0.020927</span>
<span class="co">#&gt; [2,] 0.099926 0.10908       NA 0.029108 0.10156 0.13821        NA  NA  NA  NA 0.073731 0.024613</span>
<span class="co">#&gt; [3,] 0.092908 0.11303 0.074029 0.033669 0.08212 0.15252 0.0070972  NA  NA  NA 0.070407 0.035170</span>
<span class="co">#&gt;             650       654       658      662</span>
<span class="co">#&gt; [1,] 0.00088598 0.0088217 0.0111474 0.018159</span>
<span class="co">#&gt; [2,]         NA 0.0080903 0.0118944 0.020616</span>
<span class="co">#&gt; [3,]         NA 0.0059341 0.0077598 0.015426</span>
</pre></div>

<p>Depending on the type of analysis, one may wants to replace the <code class="sourceCode r"><span class="ot">NA</span></code>s by interpolating the neighbour values. So far, package <strong>hyperSpec</strong> provides three functions that can interpolate the <code class="sourceCode r"><span class="ot">NA</span></code>s: <code class="sourceCode r"><span class="kw">spc.NA.approx</span>()</code>, <code class="sourceCode r"><span class="kw">spc.loess</span>()</code>, and <code class="sourceCode r"><span class="kw">spc.bin</span>()</code> with <code class="sourceCode r">na.rm =<span class="st"> </span><span class="ot">TRUE</span></code> (the latter two are discussed below).</p>
<div class="sourceCode" id="cb95"><pre class="downlit">
<span class="kw">spc.corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc.NA.approx.html">spc.NA.approx</a></span>(<span class="kw">spc</span>)
<span class="kw">spc.corrected</span>[[]]
<span class="co">#&gt;           602     606      610      614     618      622       626      630      634      638</span>
<span class="co">#&gt; [1,] 0.104091 0.10782 0.068269 0.030381 0.10149 0.096626 0.0917601 0.086894 0.082028 0.077163</span>
<span class="co">#&gt; [2,] 0.099926 0.10908 0.069094 0.029108 0.10156 0.138213 0.1253167 0.112420 0.099524 0.086627</span>
<span class="co">#&gt; [3,] 0.092908 0.11303 0.074029 0.033669 0.08212 0.152518 0.0070972 0.022925 0.038752 0.054580</span>
<span class="co">#&gt;           642      646        650       654       658      662</span>
<span class="co">#&gt; [1,] 0.072297 0.020927 0.00088598 0.0088217 0.0111474 0.018159</span>
<span class="co">#&gt; [2,] 0.073731 0.024613 0.01635186 0.0080903 0.0118944 0.020616</span>
<span class="co">#&gt; [3,] 0.070407 0.035170 0.02055232 0.0059341 0.0077598 0.015426</span>
</pre></div>
<div class="sourceCode" id="cb96"><pre class="downlit">
<span class="kw">spc</span>[[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">spc</span>)]] <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">spc</span>)

<span class="kw">spc</span>[[<span class="kw">spc</span> <span class="op">&lt;</span> <span class="fl">1e-4</span>]] <span class="op">&lt;-</span> <span class="fl">NA</span>
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="fu"><a href="../reference/spc.NA.approx.html">spc.NA.approx</a></span>(<span class="kw">spc</span>),
  add = <span class="fl">TRUE</span>, col = <span class="st">"blue"</span>,
  lines.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(type = <span class="st">"b"</span>, pch = <span class="fl">19</span>, cex = <span class="fl">0.5</span>)
)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:bad"></span>
<img src="hyperSpec_files/figure-html/bad-1.png" alt="Filtering data: remove bad points.  "><p class="caption">
Figure 7.6: Filtering data: remove bad points.
</p>
</div>
</div>
<div id="sec:spikes-raman-spectra" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:spikes-raman-spectra" class="anchor"></a><span class="header-section-number">7.3.4</span> Spikes in Raman Spectra</h3>
<blockquote>
<p>…coming soon…</p>
</blockquote>
<div class="sourceCode" id="cb97"><pre class="downlit">
<span class="co"># TODO: ...coming soon...</span>
</pre></div>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
</div>
</div>
<div id="smoothing-interpolation" class="section level2">
<h2 class="hasAnchor">
<a href="#smoothing-interpolation" class="anchor"></a><span class="header-section-number">7.4</span> Smoothing Interpolation</h2>

<p>Spectra acquired by grating instruments are frequently interpolated onto a new wavelength axis, e.g., because the unequal data point spacing should be removed.
Also, the spectra can be smoothed: reducing the spectral resolution allows to increase the signal to noise ratio.
For chemometric data analysis reducing the number of data points per spectrum may be crucial as it reduces the dimensionality of the data.
Package <strong>hyperSpec</strong> provides two functions to do so: <code class="sourceCode r"><span class="kw">spc.bin</span>()</code> and <code class="sourceCode r"><span class="kw">spc.loess</span>()</code>.</p>
<p>Function <code class="sourceCode r"><span class="kw">spc.bin</span>()</code> bins the spectral axis by averaging every <code class="sourceCode r">by</code> data points.</p>
<div class="sourceCode" id="cb98"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>, wl.range = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="kw">max</span>), xoffset = <span class="fl">850</span>)
<span class="kw">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc.loess.html">spc.loess</a></span>(<span class="kw">paracetamol</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="../reference/seq.hyperSpec.html">seq</a></span>(<span class="fl">300</span>, <span class="fl">1800</span>, <span class="fl">2</span>), <span class="fu"><a href="../reference/seq.hyperSpec.html">seq</a></span>(<span class="fl">2850</span>, <span class="fl">3150</span>, <span class="fl">2</span>)))
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">p</span>, wl.range = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="kw">max</span>), xoffset = <span class="fl">850</span>, col = <span class="st">"red"</span>, add = <span class="fl">TRUE</span>)

<span class="kw">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc.bin.html">spc.bin</a></span>(<span class="kw">paracetamol</span>, <span class="fl">4</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">b</span>,
  wl.range = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="kw">max</span>), xoffset = <span class="fl">850</span>,
  lines.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(pch = <span class="fl">20</span>, cex = <span class="fl">.3</span>, type = <span class="st">"p"</span>), col = <span class="st">"blue"</span>, add = <span class="fl">TRUE</span>
)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:fig-loess"></span>
<img src="hyperSpec_files/figure-html/fig-loess-1.png" alt="Smoothing interpolation by `spc.loess()`{.r} with new data point spacing of 2 cm^-1^ (red) and `spc.bin()`{.r} (blue).  "><p class="caption">
Figure 7.7: Smoothing interpolation by <code class="sourceCode r"><span class="kw">spc.loess</span>()</code> with new data point spacing of 2 cm<sup>-1</sup> (red) and <code class="sourceCode r"><span class="kw">spc.bin</span>()</code> (blue).
</p>
</div>
<div class="sourceCode" id="cb99"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">paracetamol</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span>])
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">p</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span>], col = <span class="st">"red"</span>, add = <span class="fl">TRUE</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">b</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span>], col = <span class="st">"blue"</span>, add = <span class="fl">TRUE</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:loess-kl"></span>
<img src="hyperSpec_files/figure-html/loess-kl-1.png" alt="The magnification of Fig. \@ref(fig:fig-loess) shows how interpolation may cause a loss in signal height.  "><p class="caption">
Figure 7.8: The magnification of Fig. <a href="#fig:fig-loess">7.7</a> shows how interpolation may cause a loss in signal height.
</p>
</div>
<!-- \begin{figure} -->
<!-- \includegraphics[width=0.33\textwidth]{hyperspec-fig-fig-loess} -->
<!-- \includegraphics[width=0.33\textwidth]{hyperspec-fig-fig-loess-kl} -->
<!-- \caption{ {#fig-spcloess} -->
<!-- Smoothing interpolation by `spc.loess()`{.r} with new data point spacing of 2 cm^-1^ (red) and `spc.bin()`{.r} (blue). The magnification on the right shows how interpolation may cause a loss in signal height.} -->
<!-- \end{figure} -->
<p>Function <code class="sourceCode r"><span class="kw">spc.loess</span>()</code> applies R’s <code class="sourceCode r"><span class="kw">loess</span>()</code> function for spectral interpolation.
Figures <a href="#fig:fig-loess">7.7</a> and <a href="#fig:loess-kl">7.8</a> show the result of interpolating from 300 to 1800 and 2850 to 3150 cm<sup>-1</sup> with 2 cm<sup>-1</sup> data point distance.
This corresponds to a spectral resolution of about 4 cm<sup>-1</sup>, and the decrease in spectral resolution can be seen at the sharp bands where the maxima are not reached (due to the fact that the interpolation wavelength axis does not necessarily hit the maxima.
The original spectrum had 4064 data points with unequal data point spacing (between 0 and 1.4 cm<sup>-1</sup>).
The interpolated spectrum has 902 data points.</p>
</div>
<div id="background-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#background-correction" class="anchor"></a><span class="header-section-number">7.5</span> Background Correction</h2>

<p>To subtract a background spectrum of each of the spectra in an object, use:</p>
<div class="sourceCode" id="cb100"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="fl">2</span>, <span class="kw">background.spectrum</span>, <span class="st">"-"</span>)
</pre></div>
</div>
<div id="offset-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#offset-correction" class="anchor"></a><span class="header-section-number">7.6</span> Offset Correction</h2>

<p>Calculate the offsets and sweep them off the spectra:</p>
<div class="sourceCode" id="cb101"><pre class="downlit">
<span class="kw">offsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">min</span>)
<span class="kw">chondro.offset.corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">offsets</span>, <span class="st">"-"</span>)
</pre></div>
<p>If the offset is calculated by a function, as here with the <code class="sourceCode r"><span class="kw">min</span>()</code>, <code class="sourceCode r">hyperSpec</code>’s <code class="sourceCode r"><span class="kw">sweep</span>()</code> method offers a shortcut: <code class="sourceCode r"><span class="kw">sweep</span>()</code>’s <code class="sourceCode r">STATS</code> argument may be the function instead of a numeric vector:</p>
<div class="sourceCode" id="cb102"><pre class="downlit">
<span class="kw">chondro.offset.corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">min</span>, <span class="st">"-"</span>)
</pre></div>
</div>
<div id="baseline-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#baseline-correction" class="anchor"></a><span class="header-section-number">7.7</span> Baseline Correction</h2>
<p>Package <strong>hyperSpec</strong> comes with two functions to fit polynomial baselines.</p>

<p>Functions <code class="sourceCode r"><span class="kw">spc.fit.poly.below</span>()</code>, <code class="sourceCode r"><span class="kw">spc.fit.poly</span>()</code> fit a polynomial baseline of the given order.
A least-squares fit is done so that the function may be used on rather noisy spectra.
However, the user must supply an object that is cut appropriately.
Particularly, the supplied wavelength ranges are not weighted.</p>
<p>Function <code class="sourceCode r"><span class="kw">spc.fit.poly.below</span>()</code> tries to find appropriate support points for the baseline iteratively.</p>
<p>Both functions return a <code class="sourceCode r">hyperSpec</code> object containing the fitted baselines.
They need to be subtracted afterwards:</p>
<div class="sourceCode" id="cb103"><pre class="downlit">
<span class="kw">bl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc.fit.poly.html">spc.fit.poly.below</a></span>(<span class="kw">chondro</span>)
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="kw">chondro</span> <span class="op">-</span> <span class="kw">bl</span>
</pre></div>
<p>For details, see <code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"baseline"</span>)</code>.</p>
<p>Package package <strong>baseline</strong><span class="citation">[<a href="#ref-baseline" role="doc-biblioref">2</a>]</span> offers many more functions for baseline correction.
The <code class="sourceCode r"><span class="kw">baseline</span>()</code> function works on the spectra matrix, which is extracted by <code>[[]]</code>.
The result is a <code class="sourceCode r">baseline</code> object, but can easily be re-imported into the <code class="sourceCode r">hyperSpec</code> object:</p>
<div class="sourceCode" id="cb104"><pre class="downlit">
<span class="kw">corrected</span> <span class="op">&lt;-</span> <span class="kw">hyperSpec</span>::<span class="kw"><a href="../reference/chondro.html">chondro</a></span>[<span class="fl">1</span>] <span class="co"># start with the unchanged data set</span>

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"baseline"</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'baseline'</span>
<span class="co">#&gt; The following object is masked from 'package:pls':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     mvrValstats</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     getCall</span>
<span class="kw">bl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/baseline.html">baseline</a></span>(<span class="kw">corrected</span>[[]], method = <span class="st">"modpolyfit"</span>, degree = <span class="fl">4</span>)
<span class="kw">corrected</span>[[]] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/getBaseline.html">getCorrected</a></span>(<span class="kw">bl</span>)
</pre></div>
<p>Fig. <a href="#fig:bl-baseline">7.9</a> and <a href="#fig:bl-baseline-2">7.10</a> show raw data and the result for the first spectrum of <code class="sourceCode r">chondro</code>.</p>
<div class="sourceCode" id="cb105"><pre class="downlit">
<span class="kw">baseline</span> <span class="op">&lt;-</span> <span class="kw">corrected</span>
<span class="kw">baseline</span>[[]] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/getBaseline.html">getBaseline</a></span>(<span class="kw">bl</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">hyperSpec</span>::<span class="kw"><a href="../reference/chondro.html">chondro</a></span>[<span class="fl">1</span>], plot.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(ylim = <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw">hyperSpec</span>::<span class="kw"><a href="../reference/chondro.html">chondro</a></span>[<span class="fl">1</span>], <span class="fl">0</span>)))
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">baseline</span>, add = <span class="fl">TRUE</span>, col = <span class="st">"red"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:bl-baseline"></span>
<img src="hyperSpec_files/figure-html/bl-baseline-1.png" alt="The first spectrum of `chondro`{.r} (raw data) with baseline.  "><p class="caption">
Figure 7.9: The first spectrum of <code class="sourceCode r">chondro</code> (raw data) with baseline.
</p>
</div>
<div class="sourceCode" id="cb106"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">corrected</span>, plot.args = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(ylim = <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="kw">hyperSpec</span>::<span class="kw"><a href="../reference/chondro.html">chondro</a></span>[<span class="fl">1</span>], <span class="fl">0</span>)))
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:bl-baseline-2"></span>
<img src="hyperSpec_files/figure-html/bl-baseline-2-1.png" alt='Baseline correction using the **baseline** package:
the first spectrum of `chondro`{.r}  after baseline correction with method "odpolyfi".  '><p class="caption">
Figure 7.10: Baseline correction using the <strong>baseline</strong> package:
the first spectrum of <code class="sourceCode r">chondro</code> after baseline correction with method “odpolyfi”.
</p>
</div>
<div class="sourceCode" id="cb107"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">bl</span>, <span class="kw">chondro</span>)
</pre></div>
</div>
<div id="intensity-calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#intensity-calibration" class="anchor"></a><span class="header-section-number">7.8</span> Intensity Calibration</h2>
<div id="correcting-by-a-constant-e--g--readout-bias" class="section level3">
<h3 class="hasAnchor">
<a href="#correcting-by-a-constant-e--g--readout-bias" class="anchor"></a><span class="header-section-number">7.8.1</span> Correcting by a constant, e. g. Readout Bias</h3>
<p>CCD cameras often operate with a bias, causing a constant value for each pixel. Such a constant can be immediately subtracted: <code class="sourceCode r">spectra <span class="op">-</span><span class="st"> </span>constant</code>.</p>
</div>
<div id="correcting-wavelength-dependence" class="section level3">
<h3 class="hasAnchor">
<a href="#correcting-wavelength-dependence" class="anchor"></a><span class="header-section-number">7.8.2</span> Correcting Wavelength Dependence</h3>

<p>For each of the wavelengths the same correction needs to be applied to all spectra.</p>
<ol style="list-style-type: decimal">
<li>
<p>There might be wavelength dependent offsets (background or dark spectra).
They are subtracted:</p>
<div class="sourceCode" id="cb108"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="fl">2</span>, <span class="kw">offset.spectrum</span>, <span class="st">"-"</span>)
</pre></div>
</li>
<li>
<p>A multiplicative dependency such as a CCD’s photon efficiency:</p>
<div class="sourceCode" id="cb109"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="fl">2</span>, <span class="kw">photon.efficiency</span>, <span class="st">"/"</span>)
</pre></div>
</li>
</ol>
</div>
<div id="spectra-dependent-correction" class="section level3">
<h3 class="hasAnchor">
<a href="#spectra-dependent-correction" class="anchor"></a><span class="header-section-number">7.8.3</span> Spectra Dependent Correction</h3>

<p>If the correction depends on the spectra (e. g. due to inhomogeneous illumination while collecting imaging data, differing optical path length, etc.), the <code class="sourceCode r">MARGIN</code> of the <code class="sourceCode r"><span class="kw">sweep</span>()</code> function needs to be 1 or <code class="sourceCode r">SPC</code>:</p>
<ol style="list-style-type: decimal">
<li>
<p>Pixel dependent offsets are subtracted:</p>
<div class="sourceCode" id="cb110"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="kw">SPC</span>, <span class="kw">pixel.offsets</span>, <span class="st">"-"</span>)
</pre></div>
</li>
<li>
<p>A multiplicative dependency:</p>
<div class="sourceCode" id="cb111"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="kw">SPC</span>, <span class="kw">illumination.factors</span>, <span class="st">"*"</span>)
</pre></div>
</li>
</ol>
</div>
</div>
<div id="normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#normalization" class="anchor"></a><span class="header-section-number">7.9</span> Normalization</h2>

<p>Again, <code class="sourceCode r"><span class="kw">sweep</span>()</code> is the function of choice.
E.g., for area normalization, use:</p>
<div class="sourceCode" id="cb112"><pre class="downlit">
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">mean</span>, <span class="st">"/"</span>)
</pre></div>
<p>(Using the mean instead of the sum results in conveniently scaled spectra with intensities around 1.)</p>
<p>If the calculation of the normalization factors is more elaborate, use a two step procedure:</p>
<ol style="list-style-type: decimal">
<li><p>Calculate appropriate normalization factors
You may calculate the factors using only a certain wavelength range, thereby normalizing on a particular band or peak.</p></li>
<li>
<p>Again, sweep the factor off the spectra:</p>
<div class="sourceCode" id="cb113"><pre class="downlit">
<span class="kw">normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">spectra</span>, <span class="fl">1</span>, <span class="kw">factors</span>, <span class="st">"*"</span>)
</pre></div>
</li>
</ol>
<div class="sourceCode" id="cb114"><pre class="downlit">
<span class="kw">factors</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="../reference/apply.html">apply</a></span>(<span class="kw">chondro</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span>], <span class="fl">1</span>, <span class="kw">mean</span>)
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">chondro</span>, <span class="fl">1</span>, <span class="kw">factors</span>, <span class="st">"*"</span>)
</pre></div>
<p>For the special case of area normalization using the <code class="sourceCode r">mean</code> spectra, the factors can be more conveniently calculated by</p>
<div class="sourceCode" id="cb115"><pre class="downlit">
<span class="kw">factors</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="kw">chondro</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span>])
</pre></div>
<p>and instead of <code class="sourceCode r">sweep</code> the arithmetic operators (here <code class="sourceCode r"><span class="op">*</span></code>) can be used directly with the normalization factor:</p>
<div class="sourceCode" id="cb116"><pre class="downlit">
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="kw">chondro</span> <span class="op">*</span> <span class="kw">factors</span>
</pre></div>
<p>Put together, this results in:</p>
<div class="sourceCode" id="cb117"><pre class="downlit">
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="kw">chondro</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowMeans</a></span>(<span class="kw">chondro</span>[, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span>])
</pre></div>
<p>For minimum-maximum-normalization, first do an offset- or baseline correction, then normalize using <code class="sourceCode r"><span class="kw">max</span>()</code>.</p>
</div>
<div id="centering-and-variance-scaling-the-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#centering-and-variance-scaling-the-spectra" class="anchor"></a><span class="header-section-number">7.10</span> Centering and Variance Scaling the Spectra</h2>

<p>Centering means that the mean spectrum is subtracted from each of the spectra.
Many data analysis techniques, like principal component analysis, partial least squares, etc., work much better on centered data.
From a spectroscopic point of view it depends on the particular data set whether centering does make sense or not.</p>
<p>Variance scaling is often used in multivariate analysis to adjust the influence and scaling of the variates (that are typically different physical values).
However, spectra already do have the same scale of the same physical value.
Thus one has to trade off the the expected numeric benefit with the fact that for wavelengths with low signal the noise level will“xplod”by variance scaling.
Scaling usually makes sense only for centered data.</p>
<p>Both tasks are carried out by the same method in <code>R</code>, <code class="sourceCode r"><span class="kw">scale</span>()</code>, which will by default both mean center and variance scale the spectra matrix.</p>
<p>To center the <code class="sourceCode r">flu</code> data set, use:</p>
<div class="sourceCode" id="cb118"><pre class="downlit">
<span class="kw">flu.centered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale,hyperSpec-method.html">scale</a></span>(<span class="kw">flu</span>, scale = <span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">flu.centered</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:centre-flu"></span>
<img src="hyperSpec_files/figure-html/centre-flu-1.png" alt="Mean-centered spectra of `flu`.  "><p class="caption">
Figure 7.11: Mean-centered spectra of <code>flu</code>.
</p>
</div>
<p>On the other hand, the <code class="sourceCode r">chondro</code> data set consists of Raman spectra, so the spectroscopic interpretation of centering is getting rid of the the average chemical composition of the sample.
But what is the meaning of the “Average spectrum” of an inhomogeneous sample?
In this case it may be better to subtract the minimum spectrum (which will hopefully have almost the same benefit on the data analysis) as it is the spectrum of that chemical composition that is underlying the whole sample.</p>
<p>One more point to consider is that the actual minimum spectrum will pick up (negative) noise.
In order to avoid that, using, e.g., the 5<sup>th</sup> percentile spectrum is more suitable:</p>
<div class="sourceCode" id="cb119"><pre class="downlit">
<span class="kw">chondro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale,hyperSpec-method.html">scale</a></span>(<span class="kw">chondro</span>, center = <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="kw">chondro</span>, <span class="fl">0.05</span>), scale = <span class="fl">FALSE</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">chondro</span>, <span class="st">"spcprctl5"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:perc"></span>
<img src="hyperSpec_files/figure-html/perc-1.png" alt="The summary spectra of `chondro` with 5^th^ percentile subtracted.  "><p class="caption">
Figure 7.12: The summary spectra of <code>chondro</code> with 5<sup>th</sup> percentile subtracted.
</p>
</div>
<p>See section the appendices for some tips to speed up these calculations.</p>
</div>
<div id="multiplicative-scatter-correction" class="section level2">
<h2 class="hasAnchor">
<a href="#multiplicative-scatter-correction" class="anchor"></a><span class="header-section-number">7.11</span> Multiplicative Scatter Correction</h2>

<p>Multiplicative scatter correction (MSC) can be done using <code class="sourceCode r"><span class="kw">msc</span>()</code> from package package <strong>pls</strong> <span class="citation">[<a href="#ref-pls" role="doc-biblioref">3</a>]</span>.
It operates on the spectra matrix:</p>
<div class="sourceCode" id="cb120"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://mevik.net/work/software/pls.html">pls</a></span>)
<span class="kw">chondro.msc</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>
<span class="kw">chondro.msc</span>[[]] <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/msc.html">msc</a></span>(<span class="kw">chondro</span>[[]])
</pre></div>
</div>
<div id="spectral-arithmetic" class="section level2">
<h2 class="hasAnchor">
<a href="#spectral-arithmetic" class="anchor"></a><span class="header-section-number">7.12</span> Spectral Arithmetic</h2>

<p>Basic mathematical functions are defined for <code class="sourceCode r">hyperSpec</code> objects.
You may convert spectra:</p>
<div class="sourceCode" id="cb121"><pre class="downlit">
<span class="kw">absorbance.spectra</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span>(<span class="kw">transmission.spectra</span>)
</pre></div>

<p>In this case, do not forget to adapt the label:</p>
<div class="sourceCode" id="cb122"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/labels.html">labels</a></span>(<span class="kw">absorbance.spectra</span>)<span class="op">$</span><span class="kw">spc</span> <span class="op">&lt;-</span> <span class="st">"A"</span>
</pre></div>
<p>Be careful: <code>R</code>’s <code class="sourceCode r"><span class="kw">log</span>()</code> function calculates the <em>natural</em> logarithm if no base is given.</p>
<p>The basic arithmetic operators work element-wise in <code>R</code>.
Thus they all need either a scalar, or a matrix (or <code class="sourceCode r">hyperSpec</code> object) of the correct size.</p>
<p>Matrix multiplication is done by <code>\%*%</code>, again each of the operands may be a matrix or a <code class="sourceCode r">hyperSpec</code> object, and must have the correct dimensions.</p>
</div>
</div>
<div id="data-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#data-analysis" class="anchor"></a><span class="header-section-number">8</span> Data Analysis</h1>
<div id="sec:pca" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:pca" class="anchor"></a><span class="header-section-number">8.1</span> Data Analysis Methods using a <code class="sourceCode r">data.frame</code>, e.g., Principal Component Analysis with <code class="sourceCode r"><span class="kw">prcomp</span>()</code>
</h2>

<p>The <code class="sourceCode r"><span class="op">$</span>.</code> notation is handy, if a data analysis function expects a <code class="sourceCode r">data.frame</code>.
The column names can then be used in the formula:</p>
<div class="sourceCode" id="cb123"><pre class="downlit">
<span class="kw">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="op">~</span><span class="kw">spc</span>, data = <span class="kw">chondro</span><span class="op">$</span><span class="kw">.</span>, center = <span class="fl">FALSE</span>)
</pre></div>
<p>Many modeling functions call <code class="sourceCode r">as.data.frame</code> on their <code class="sourceCode r">data</code> argument.
In that case, the conversion is done automatically:</p>
<div class="sourceCode" id="cb124"><pre class="downlit">
<span class="kw">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span>(<span class="op">~</span><span class="kw">spc</span>, data = <span class="kw">chondro</span>, center = <span class="fl">FALSE</span>)
</pre></div>
<p>Results of such a  decomposition can be put again into <code class="sourceCode r">hyperSpec</code> objects.
This allows to plot, e.g., the loading like spectra, or score maps, see Figures <a href="#fig:pca-load">8.1</a> and <a href="#fig:pca-score">8.2</a>.</p>
<div class="sourceCode" id="cb125"><pre class="downlit">
<span class="kw">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span>(<span class="kw">chondro</span>, <span class="kw">pca</span><span class="op">$</span><span class="kw">x</span>,
  label.wavelength = <span class="st">"PC"</span>,
  label.spc = <span class="st">"score / a.u."</span>
)
<span class="kw">scores</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    875 spectra</span>
<span class="co">#&gt;    5 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: PC [integer] 1 2 ... 300 </span>
<span class="co">#&gt; data:  (875 rows x 5 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] -4.77 -4.77 ... 19.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -11.55 -10.55 ... 22.45 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] matrix matrix ... lacuna + NA</span>
<span class="co">#&gt;    5. spc: score / a.u. [matrix, array300] -0.43543 -0.92192 ... -1.249e-16</span>
</pre></div>
<p>The loadings can be similarly re-imported:</p>
<div class="sourceCode" id="cb126"><pre class="downlit">
<span class="kw">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span>(<span class="kw">chondro</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">pca</span><span class="op">$</span><span class="kw">rotation</span>),
  scores = <span class="fl">FALSE</span>,
  label.spc = <span class="st">"loading I / a.u."</span>
)
<span class="kw">loadings</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    300 spectra</span>
<span class="co">#&gt;    2 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (300 rows x 2 columns)</span>
<span class="co">#&gt;    1. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    2. spc: loading I / a.u. [matrix, array300] -0.0258979 -0.0014762 ... -0.17923</span>
</pre></div>
<p>There is, however, one important difference.
The loadings are thought of as values computed from all spectra together.
Thus no meaningful extra data can be assigned for the loadings object (at least not if the column consists of different values).
Therefore, the loadings object lost all extra data (see above).</p>
<p>Argument <code class="sourceCode r">retain.columns</code> triggers whether columns that contain different values should be dropped.
If it is set to <code class="sourceCode r"><span class="ot">TRUE</span></code>, the columns are retained, but contain <code class="sourceCode r"><span class="ot">NA</span></code>s:</p>
<div class="sourceCode" id="cb127"><pre class="downlit">
<span class="kw">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span>(<span class="kw">chondro</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">pca</span><span class="op">$</span><span class="kw">rotation</span>),
  scores = <span class="fl">FALSE</span>,
  retain.columns = <span class="fl">TRUE</span>, label.spc = <span class="st">"loading I / a.u."</span>
)
<span class="kw">loadings</span>[<span class="fl">1</span>]<span class="op">$</span><span class="kw">..</span>
<span class="co">#&gt;      y  x            filename clusters</span>
<span class="co">#&gt; PC1 NA NA rawdata/chondro.txt     &lt;NA&gt;</span>
</pre></div>
<p>If an extra data column does contain only one unique value, it is retained anyways:</p>
<div class="sourceCode" id="cb128"><pre class="downlit">
<span class="kw">chondro</span><span class="op">$</span><span class="kw">measurement</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span>(<span class="kw">chondro</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw">pca</span><span class="op">$</span><span class="kw">rotation</span>),
  scores = <span class="fl">FALSE</span>,
  label.spc = <span class="st">"loading I / a.u."</span>
)
<span class="kw">loadings</span>[<span class="fl">1</span>]<span class="op">$</span><span class="kw">..</span>
<span class="co">#&gt;                filename measurement</span>
<span class="co">#&gt; PC1 rawdata/chondro.txt           1</span>
</pre></div>
<div class="sourceCode" id="cb129"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">loadings</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>], stacked = <span class="fl">TRUE</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:pca-load"></span>
<img src="hyperSpec_files/figure-html/pca-load-1.png" alt="The first three loadings.  "><p class="caption">
Figure 8.1: The first three loadings.
</p>
</div>
<div class="sourceCode" id="cb130"><pre class="downlit">
<span class="kw">div_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="st">"#00008B"</span>, <span class="st">"#351C96"</span>, <span class="st">"#5235A2"</span>, <span class="st">"#6A4CAE"</span>, <span class="st">"#8164BA"</span>, <span class="st">"#967CC5"</span>,
  <span class="st">"#AC95D1"</span>, <span class="st">"#C1AFDC"</span>, <span class="st">"#D5C9E8"</span>, <span class="st">"#E0E3E3"</span>, <span class="st">"#F8F8B0"</span>, <span class="st">"#F7E6C2"</span>,
  <span class="st">"#EFCFC6"</span>, <span class="st">"#E6B7AB"</span>, <span class="st">"#DCA091"</span>, <span class="st">"#D08977"</span>, <span class="st">"#C4725E"</span>, <span class="st">"#B75B46"</span>,
  <span class="st">"#A9432F"</span>, <span class="st">"#9A2919"</span>, <span class="st">"#8B0000"</span>
), space = <span class="st">"Lab"</span>)
</pre></div>
<div class="sourceCode" id="cb131"><pre class="downlit">
<span class="fu"><a href="../reference/plotmap.html">plotmap</a></span>(<span class="kw">scores</span>[, , <span class="fl">3</span>], col.regions = <span class="fu">div_palette</span>(<span class="fl">20</span>))
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:pca-score"></span>
<img src="hyperSpec_files/figure-html/pca-score-1.png" alt="The third score map.  "><p class="caption">
Figure 8.2: The third score map.
</p>
</div>
<div id="sec:pca-as-noise" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:pca-as-noise" class="anchor"></a><span class="header-section-number">8.1.1</span> PCA as Noise Filter</h3>
<p>Principal component analysis is sometimes used as a noise filtering technique.
The idea is that the relevant differences are captured in the first components while the higher components contain noise only.
Thus the spectra are reconstructed using only the first <span class="math inline">\(p\)</span> components.</p>
<p>This reconstruction is in fact a matrix multiplication:</p>
<!-- Equation ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
<p><span class="math display" id="eq:equation-1">\[\begin{equation}

  \mathrm{spectra}^{\mathrm{~nrow} ~×~ \mathrm{nwl}} = \mathrm{scores}^{\mathrm{~nrow} ~×~ p} \;\cdot\; \mathrm{loadings}^{~p ~×~ \mathrm{nwl}}
  \tag{8.1}

\end{equation}\]</span>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  --></p>
<p>Note that this corresponds to a model based on the Beer-Lambert law:
<!-- Equation ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
<span class="math display" id="eq:equation-2">\[\begin{equation}

  A_n (\lambda) = c_{n,i} \epsilon (i, \lambda) + \mathrm{error}
  \tag{8.2}

\end{equation}\]</span>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
The matrix formulation puts the <span class="math inline">\(n\)</span> spectra into the rows of <span class="math inline">\(A\)</span> and <span class="math inline">\(c\)</span>, while the <span class="math inline">\(i\)</span> pure components appear in the columns of <span class="math inline">\(c\)</span> and rows of the absorbance coefficients <span class="math inline">\(\epsilon\)</span>.</p>
<p>For an ideal data set (constituents varying independently, sufficient signal to noise ratio) one would expect the principal component analysis to extract something like the concentrations and pure component spectra.</p>

<p>If we decide that only the first 10 components actually carry spectroscopic information, we can reconstruct spectra with better signal to noise ratio:</p>
<div class="sourceCode" id="cb132"><pre class="downlit">
<span class="kw">smoothed</span> <span class="op">&lt;-</span> <span class="kw">scores</span>[, , <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>] <span class="op">%*%</span> <span class="kw">loadings</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">10</span>]
</pre></div>
<p>Keep in mind, though, that we cannot be sure how much <em>useful</em> information was discarded with the higher components.
This kind of noise reduction may influence further modeling of the data. Mathematically speaking, the rank of the new 875 <span class="math inline">\(×\)</span> 300 spectra matrix is only 10.</p>
</div>
</div>
<div id="sec:as-long-df" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:as-long-df" class="anchor"></a><span class="header-section-number">8.2</span> Data Analysis using long-format <code>data.frame</code> e.g., plotting with <strong><em>ggplot2</em></strong>
</h2>

<p>Some functions need the data being an <em>unstacked</em> or <em>long-format</em> <code class="sourceCode r">data.frame</code>.
Function <code class="sourceCode r"><span class="kw">as.long.df</span>()</code> is the appropriate conversion function.</p>
<div class="sourceCode" id="cb133"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="../reference/as.data.frame.html">as.long.df</a></span>(<span class="kw">chondro</span>[<span class="fl">1</span>]), <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(x = <span class="kw">.wavelength</span>, y = <span class="kw">spc</span>)) <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:ggplot"></span>
<img src="hyperSpec_files/figure-html/ggplot-1.png" alt="A plot of spectrum created with **ggplot2**.  "><p class="caption">
Figure 8.3: A plot of spectrum created with <strong>ggplot2</strong>.
</p>
</div>
</div>
<div id="HCA" class="section level2">
<h2 class="hasAnchor">
<a href="#HCA" class="anchor"></a><span class="header-section-number">8.3</span> Data Analysis Methods using a matrix e.g., Hierarchical Cluster Analysis</h2>

<p>Some functions expect their input data in a matrix, so either <code class="sourceCode r"><span class="kw">as.matrix</span>(object)</code> or the abbreviation <code class="sourceCode r">object[[]]</code> can be used:</p>
<div class="sourceCode" id="cb134"><pre class="downlit">
<span class="kw">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pearson.dist.html">pearson.dist</a></span>(<span class="kw">chondro</span>[[]])
</pre></div>
<p>Again, many such functions coerce the data to a matrix automatically, so the <code class="sourceCode r">hyperSpec</code> object can be
handed over:</p>
<div class="sourceCode" id="cb135"><pre class="downlit">
<span class="kw">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pearson.dist.html">pearson.dist</a></span>(<span class="kw">chondro</span>)
<span class="kw">dendrogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span>(<span class="kw">dist</span>, method = <span class="st">"ward.D"</span>)
</pre></div>
<div class="sourceCode" id="cb136"><pre class="downlit">
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">dendrogram</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:dend"></span>
<img src="hyperSpec_files/figure-html/dend-1.png" alt="The results of the cluster analysis: the dendrogram.  "><p class="caption">
Figure 8.4: The results of the cluster analysis: the dendrogram.
</p>
</div>
<p>In order to plot a cluster map, the cluster membership needs to be calculated from the dendrogram.</p>
<p>First, cut the dendrogram so that three clusters result:</p>
<div class="sourceCode" id="cb137"><pre class="downlit">
<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/cutree.html">cutree</a></span>(<span class="kw">dendrogram</span>, k = <span class="fl">3</span>))
</pre></div>
<p>As the cluster membership was stored as factor, the levels can be meaningful names, which are displayed in the color legend.</p>
<div class="sourceCode" id="cb138"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>) <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"matrix"</span>, <span class="st">"lacuna"</span>, <span class="st">"cell"</span>)
</pre></div>
<p>Then the result may be plotted (Figure <a href="#fig:clust-map">8.5</a>):</p>
<div class="sourceCode" id="cb139"><pre class="downlit">
<span class="fu"><a href="../reference/plotmap.html">plotmap</a></span>(<span class="kw">chondro</span>, <span class="kw">clusters</span> <span class="op">~</span> <span class="kw">x</span> <span class="op">*</span> <span class="kw">y</span>, col.regions = <span class="kw">cluster.cols</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:clust-map"></span>
<img src="hyperSpec_files/figure-html/clust-map-1.png" alt="The results of the cluster analysis: the map of the 3 clusters.  "><p class="caption">
Figure 8.5: The results of the cluster analysis: the map of the 3 clusters.
</p>
</div>
</div>
<div id="calculating-group-wise-sum-characteristics-e--g--cluster-mean-spectra" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-group-wise-sum-characteristics-e--g--cluster-mean-spectra" class="anchor"></a><span class="header-section-number">8.4</span> Calculating group-wise Sum Characteristics, e. g. Cluster Mean Spectra</h2>

<p>Function <code class="sourceCode r"><span class="kw">aggregate</span>()</code> applies the function given in <code class="sourceCode r">FUN</code> to each of the groups of spectra specified in <code class="sourceCode r">by</code>.</p>
<p>So we may plot the cluster mean spectra:</p>
<div class="sourceCode" id="cb140"><pre class="downlit">
<span class="kw">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate.html">aggregate</a></span>(<span class="kw">chondro</span>, by = <span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>, <span class="kw">mean_pm_sd</span>)
<span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="kw">means</span>, col = <span class="kw">cluster.cols</span>, stacked = <span class="st">".aggregate"</span>, fill = <span class="st">".aggregate"</span>)
</pre></div>
<div class="figure" style="text-align: center">
<span id="fig:clustmean"></span>
<img src="hyperSpec_files/figure-html/clustmean-1.png" alt="The results of the cluster analysis: the the mean spectra.  "><p class="caption">
Figure 8.6: The results of the cluster analysis: the the mean spectra.
</p>
</div>
</div>
<div id="factor-columns-in-hyperspec-objects-dropping-factor-levels-that-are-not-needed" class="section level2">
<h2 class="hasAnchor">
<a href="#factor-columns-in-hyperspec-objects-dropping-factor-levels-that-are-not-needed" class="anchor"></a><span class="header-section-number">8.5</span> Factor columns in <code class="sourceCode r">hyperSpec</code> Objects: dropping factor levels that are not needed</h2>

<p>For subsections of <code class="sourceCode r">hyperSpec</code> objects that do not contain all levels of a factor column, <code class="sourceCode r"><span class="kw">droplevels</span>()</code> drops the “unpopulated” levels:</p>
<div class="sourceCode" id="cb141"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">50</span>]
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">tmp</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; matrix lacuna   cell </span>
<span class="co">#&gt;     22     28      0</span>
</pre></div>
<div class="sourceCode" id="cb142"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="kw">tmp</span>)
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">tmp</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; matrix lacuna </span>
<span class="co">#&gt;     22     28</span>
</pre></div>
</div>
<div id="splitting-an-object-and-binding-a-list-of-hyperspec-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#splitting-an-object-and-binding-a-list-of-hyperspec-objects" class="anchor"></a><span class="header-section-number">8.6</span> Splitting an Object, and Binding a List of <code class="sourceCode r">hyperSpec</code> Objects</h2>

<p>A <code class="sourceCode r">hyperSpec</code> object may also be split into a list of <code class="sourceCode r">hyperSpec</code> objects:</p>
<div class="sourceCode" id="cb143"><pre class="downlit">
<span class="kw">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split.html">split</a></span>(<span class="kw">chondro</span>, <span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="kw">clusters</span>
<span class="co">#&gt; $matrix</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    187 spectra</span>
<span class="co">#&gt;    6 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (187 rows x 6 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] -4.77 -4.77 ... 19.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -11.55 -10.55 ... -11.55 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] matrix matrix ... matrix </span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 0.011964 0.022204 ... 0.13706 </span>
<span class="co">#&gt;    6. measurement: measurement [numeric] 1 1 ... 1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $lacuna</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    546 spectra</span>
<span class="co">#&gt;    6 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (546 rows x 6 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] -4.77 -4.77 ... 19.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -8.55 -7.55 ... 22.45 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] lacuna lacuna ... lacuna </span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 0.038900 0.031386 ... 0.049803 </span>
<span class="co">#&gt;    6. measurement: measurement [numeric] 1 1 ... 1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $cell</span>
<span class="co">#&gt; hyperSpec object</span>
<span class="co">#&gt;    142 spectra</span>
<span class="co">#&gt;    6 data columns</span>
<span class="co">#&gt;    300 data points / spectrum</span>
<span class="co">#&gt; wavelength: Delta * tilde(nu)/cm^-1 [numeric] 602 606 ... 1798 </span>
<span class="co">#&gt; data:  (142 rows x 6 columns)</span>
<span class="co">#&gt;    1. y: y [numeric] 4.23 4.23 ... 16.23 </span>
<span class="co">#&gt;    2. x: x [numeric] -7.55 -6.55 ... 14.45 </span>
<span class="co">#&gt;    3. filename: filename [character] rawdata/chondro.txt rawdata/chondro.txt ... rawdata/chondro.txt </span>
<span class="co">#&gt;    4. clusters: clusters [factor] cell cell ... cell </span>
<span class="co">#&gt;    5. spc: I / a.u. [matrix, array300] 0.024574 0.027541 ... 0.017377 </span>
<span class="co">#&gt;    6. measurement: measurement [numeric] 1 1 ... 1</span>
</pre></div>

<p>Splitting can be reversed by <code class="sourceCode r"><span class="kw">rbind</span>()</code> (see section <a href="#sec:bind">5.1</a>).

Another, similar way to combine a number of <code class="sourceCode r">hyperSpec</code> objects with different wavelength axes or extra data columns is <code class="sourceCode r"><span class="kw">collapse</span>()</code> (see section <a href="#sec:collapse">5.2</a>).</p>
<p>Both <code class="sourceCode r"><span class="kw">rbind</span>()</code> and <code class="sourceCode r"><span class="kw">collapse</span>()</code> take care that factor levels are expanded as necessary:</p>
<div class="sourceCode" id="cb144"><pre class="downlit">
<span class="kw">lacunae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="kw">chondro</span>[<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span> <span class="op">==</span> <span class="st">"lacuna"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>)])
<span class="fu"><a href="../reference/as.character,hyperSpec-method.html">summary</a></span>(<span class="kw">lacunae</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt; lacuna </span>
<span class="co">#&gt;    546</span>
</pre></div>
<div class="sourceCode" id="cb145"><pre class="downlit">
<span class="kw">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="kw">chondro</span>[<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span> <span class="op">==</span> <span class="st">"cell"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="kw">chondro</span><span class="op">$</span><span class="kw">clusters</span>)])
<span class="fu"><a href="../reference/as.character,hyperSpec-method.html">summary</a></span>(<span class="kw">cells</span><span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt; cell </span>
<span class="co">#&gt;  142</span>
</pre></div>
<div class="sourceCode" id="cb146"><pre class="downlit">
<span class="fu"><a href="../reference/as.character,hyperSpec-method.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">cells</span>, <span class="kw">lacunae</span>)<span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt;   cell lacuna </span>
<span class="co">#&gt;    142    546</span>
</pre></div>
<div class="sourceCode" id="cb147"><pre class="downlit">
<span class="fu"><a href="../reference/as.character,hyperSpec-method.html">summary</a></span>(<span class="fu"><a href="../reference/collapse.html">collapse</a></span>(<span class="kw">cells</span>, <span class="kw">lacunae</span>)<span class="op">$</span><span class="kw">clusters</span>)
<span class="co">#&gt;   cell lacuna </span>
<span class="co">#&gt;    142    546</span>
</pre></div>

</div>
</div>
<div id="appendix-1--overview-of-the-functions-provided-by-package-hyperspec" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#appendix-1--overview-of-the-functions-provided-by-package-hyperspec" class="anchor"></a>Appendix 1. Overview of the functions provided by package <strong>hyperSpec</strong>
</h1>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
<table class="table">
<caption>
<strong><span id="tab:functions">Table 8.1: </span></strong> Overview of the functions provided by package <strong><em>hyperSpec</em></strong>
</caption>
<colgroup>
<col width="24%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th><strong>Function</strong></th>
<th><strong>Explanation</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Access parts of the object</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r"><a href="../reference/%5B,hyperSpec-method.html">[</a></code></td>
<td>Select / extract / delete spectra, wavelength ranges or extra data</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">[&lt;-</code></td>
<td>Set parts of spectra or extra data</td>
</tr>
<tr class="even">
<td><code class="sourceCode r"><a href="../reference/%5B,hyperSpec-method.html">[[</a></code></td>
<td>Select / extract / delete spectra, wavelength ranges or extra data, get the result as <code>matrix</code> or <code>data.frame</code>
</td>
</tr>
<tr class="odd">
<td><code>[[&lt;-</code></td>
<td>Set parts of spectra matrix</td>
</tr>
<tr class="even">
<td><code class="sourceCode r"><span class="op">$</span></code></td>
<td>extract a data column (including <code>$spc</code>)</td>
</tr>
<tr class="odd">
<td><code>$&lt;-</code></td>
<td>replace a data column (including <code>$spc</code>)</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">i2wl</code></td>
<td>convert spectra matrix column indices to wavelengths</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">isample</code></td>
<td>get a random sample of the spectra as index vector</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">labels</code></td>
<td>get column labels</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">labels&lt;-</code></td>
<td>set column labels</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">rownames&lt;-</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">sample</code></td>
<td>generate random sample of the spectra</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">seq.hyperSpec</code></td>
<td>sequence along the spectra, either as <code class="sourceCode r">hyperSpec</code> object or index vector</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">wl</code></td>
<td>extract the wavelengths</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">wl&lt;-</code></td>
<td>replace the wavelengths</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">wl2i</code></td>
<td>convert wavelengths to spectra matrix column indices</td>
</tr>
<tr class="even">
<td><strong>Maths</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r"><span class="op">%*%</span></code></td>
<td>matrix multiplication</td>
</tr>
<tr class="even">
<td><strong>Vectorization</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">aggregate</code></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">apply</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">sweep</code></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Comparison</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">all.equal</code></td>
<td></td>
</tr>
<tr class="even">
<td><strong>Plotting</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">alois.palette</code></td>
<td>another palette</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">levelplot</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">map.identify</code></td>
<td>identify spectra in map plot</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">map.sel.poly</code></td>
<td>identify spectra in map plot: select polygon</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">mark.dendrogram</code></td>
<td>mark samples in hclust dendrogram</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">matlab.dark.palette</code></td>
<td>darker version of <code class="sourceCode r"><span class="kw">matlab.palette</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">matlab.palette</code></td>
<td>palette resembling Matlab’s jet colors</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">plot</code></td>
<td>main switchyard for plotting</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">plotc</code></td>
<td>intensity over one other dimension: calibration plots, time series, depth series, etc.</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">plotmap</code></td>
<td>false-colour intensity over two other dimensions: spectral images, maps, etc. (rectangular tesselation)</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">plotspc</code></td>
<td>spectra plots: intensity over wavelength</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">plotvoronoi</code></td>
<td>false-colour intensity over two other dimensions: spectral images, maps, etc. (Voronoi tesselation)</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">sel.poly</code></td>
<td>polygon selection in lattice plot</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.identify</code></td>
<td>identify spectra and wavelengths in spectra plot</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">spc.label.default</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.label.wlonly</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">spc.point.default</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.point.max</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">spc.point.min</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.point.sqr</code></td>
<td>helper for <code class="sourceCode r"><span class="kw">spc.identify</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">stacked.offsets</code></td>
<td>calculate intensity axis offsets for stacked spectral plots</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">trellis.factor.key</code></td>
<td>modify list of <code class="sourceCode r"><span class="kw">levelplot</span>()</code> arguments according to factor levels</td>
</tr>
<tr class="odd">
<td><strong>Type conversion</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">as.data.frame</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">as.long.df</code></td>
<td>convert to a long-format data.frame.</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">as.matrix</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">as.t.df</code></td>
<td>convert to a transposed data.frame (spectra in columns)</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">as.wide.df</code></td>
<td>convert to a wide-format data.frame with each wavelength one column</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">decomposition</code></td>
<td>re-import results of spectral matrix decomposition (or the like) into <code class="sourceCode r">hyperSpec</code> object</td>
</tr>
<tr class="even">
<td><strong>Combine/split</strong></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">bind</code></td>
<td>commom interface for <code class="sourceCode r"><span class="kw">rbind</span>()</code> and <code class="sourceCode r"><span class="kw">cbind</span>()</code>
</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">cbind.hyperSpec</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">collapse</code></td>
<td>combine objects by adding columns if necessary. See <code class="sourceCode r">plyr<span class="op">::</span><span class="kw">rbind.fill</span>()</code>.</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">merge</code></td>
<td>combines spectral ranges. works if spectra are in only one of the data sets</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">rbind.hyperSpec</code></td>
<td>bind objects by row, i.e., add wavelength ranges or extra data</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">split</code></td>
<td></td>
</tr>
<tr class="odd">
<td><strong>Basic information</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">chk.hy</code></td>
<td>checks whether the object is a hyperSpec object</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">colnames</code></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">colnames&lt;-</code></td>
<td></td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">ncol</code></td>
<td>number of data columns (extra data plus spectra matrix)</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">nrow</code></td>
<td>number of spectra</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">nwl</code></td>
<td>number of data points per spectrum</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">print</code></td>
<td>summary information</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">rownames</code></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">summary</code></td>
<td>summary information</td>
</tr>
<tr class="odd">
<td><strong>Create and initialize an object</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">empty</code></td>
<td>creates an hyperSpec object with 0 rows, but the same wavelengths as another object</td>
</tr>
<tr class="odd">
<td><strong>Options</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">hy.getOption</code></td>
<td>get an option</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">hy.getOptions</code></td>
<td>get more options</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">hy.setOptions</code></td>
<td>set options</td>
</tr>
<tr class="odd">
<td><strong>Tests</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">hy.unittest</code></td>
<td>run all unit tests</td>
</tr>
<tr class="odd">
<td><strong>Utility functions</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">mean</code></td>
<td>mean spectrum</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">mean_pm_sd</code></td>
<td>mean <span class="math inline">\(\pm\)</span> one standard deviation of a vector</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">mean_sd</code></td>
<td>mean and standard deviation of a vector</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">pearson.dist</code></td>
<td>distance measure based on Pearson’s <span class="math inline">\(R^2\)</span>
</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">quantile</code></td>
<td>quantile spectra</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">rbind.fill.matrix</code></td>
<td>transitional until <code class="sourceCode r">plyr<span class="op">::</span><span class="kw">rbind.fill.matrix</span>()</code> is out</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">wc</code></td>
<td>word count using <strong>wc</strong> if available on the system</td>
</tr>
<tr class="odd">
<td><strong>Spectra-specific transformations</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">orderwl</code></td>
<td>sort columns of spectra matrix according to the wavelengths</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">spc.bin</code></td>
<td>spectral binning</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.fit.poly</code></td>
<td>least sqares fit of a polynomial</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">spc.fit.poly.below</code></td>
<td>least sqares fit of a polynomial with automatic support point determination</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">spc.loess</code></td>
<td>
<code class="sourceCode r"><span class="kw">loess</span>()</code> smoothing interpolation</td>
</tr>
<tr class="odd">
<td><strong>File import/export</strong></td>
<td></td>
</tr>
<tr class="even">
<td><code class="sourceCode r">read.ENVI</code></td>
<td>import ENVI file</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">read.ENVI.Nicolet</code></td>
<td>import ENVI files writen by Nicolet spectrometers</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">read.spc</code></td>
<td>import .spc file</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">read.spc.KaiserMap</code></td>
<td>import a Raman map saved by Kaiser Optical Systems’ Hologram software as multiple .spc files</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">read.txt.long</code></td>
<td>import long-type ASCII file</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">read.txt.wide</code></td>
<td>imort wide-type ASCII file</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">scan.txt.Renishaw</code></td>
<td>import ASCII files produced by Renishaw (InVia) spectrometers</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">scan.txt.Witec</code></td>
<td>import ASCII files produced by Witec Raman spectrometers</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">scan.zip.Renishaw</code></td>
<td>directly read zip packed ASCII files produced by Renishaw spectrometers</td>
</tr>
<tr class="odd">
<td><code class="sourceCode r">write.txt.long</code></td>
<td>export as long-type ASCII file</td>
</tr>
<tr class="even">
<td><code class="sourceCode r">write.txt.wide</code></td>
<td>export as wide-type ASCII file</td>
</tr>
</tbody>
</table>
</div>
<div id="appendix-2--package-options" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#appendix-2--package-options" class="anchor"></a>Appendix 2. Package Options</h1>
<!-- ----------------------------------------------------------------------- -->
<table class="table">
<caption>
<strong><span id="tab:options">Table 8.2: </span></strong> Package <strong>hyperSpec</strong>’s options.
Please refer to the documentation of the respective functions for details about the effect of the options.</caption>
<colgroup>
<col width="17%">
<col width="17%">
<col width="46%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th>name</th>
<th align="center">default value (range)</th>
<th>description</th>
<th>used by</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>debuglevel</code></td>
<td align="center">
<code class="sourceCode r"><span class="dv">0</span></code> (<code class="sourceCode r">1L</code>, <code class="sourceCode r">2L</code>)</td>
<td>Amount of debugging information produced</td>
<td>
<code class="sourceCode r"><span class="kw">spc.identify</span>()</code>, <code class="sourceCode r"><span class="kw">map.identify</span>()</code>, <code class="sourceCode r"><span class="kw">spc.rubberband</span>()</code>,<br> various file import functions.</td>
</tr>
<tr class="even">
<td><code>gc</code></td>
<td align="center"><code class="sourceCode r"><span class="ot">FALSE</span></code></td>
<td>Triggers frequent calling of <code class="sourceCode r"><span class="kw">gc</span>()</code>
</td>
<td>
<code class="sourceCode r"><span class="kw">read.ENVI</span>()</code>, <br><code class="sourceCode r"><span class="kw">new</span>(<span class="st">"hyperSpec"</span>)</code>
</td>
</tr>
<tr class="odd">
<td><code>tolerance</code></td>
<td align="center"><code class="sourceCode r"><span class="kw">sqrt</span>(.Machine<span class="op">$</span>.double.eps)</code></td>
<td>Tolerance for numerical comparisons</td>
<td>File import functions (removing empty spectra), <code class="sourceCode r"><span class="kw">normalize01</span>()</code>
</td>
</tr>
<tr class="even">
<td><code>wl.tolerance</code></td>
<td align="center"><code class="sourceCode r"><span class="kw">sqrt</span>(.Machine<span class="op">$</span>.double.eps)</code></td>
<td>Tolerance for comparisons of the wavelength axis</td>
<td>
<code class="sourceCode r"><span class="kw">rbind</span>()</code>, <code class="sourceCode r"><span class="kw">rbind2</span>()</code>, <code class="sourceCode r"><span class="kw">bind</span>(<span class="st">"r"</span>, ...)</code>, <code class="sourceCode r"><span class="kw">all.equal</span>()</code>, <code class="sourceCode r"><span class="kw">collapse</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code>file.remove.emptyspc</code></td>
<td align="center"><code class="sourceCode r"><span class="ot">TRUE</span></code></td>
<td>Automatic removing of empty spectra</td>
<td>File import functions, see <code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"fileio"</span>)</code>
</td>
</tr>
<tr class="even">
<td><code>file.keep.name</code></td>
<td align="center"><code class="sourceCode r"><span class="ot">TRUE</span></code></td>
<td>Automatic recording of file name in column <code class="sourceCode r">filename</code>
</td>
<td>File import functions, see <code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"fileio"</span>)</code>
</td>
</tr>
<tr class="odd">
<td><code>plot.spc.nmax</code></td>
<td align="center"><code class="sourceCode r"><span class="dv">25</span></code></td>
<td>Number of spectra to be plotted by default</td>
<td><code class="sourceCode r"><span class="kw">plotspc</span>()</code></td>
</tr>
<tr class="even">
<td><code>ggplot.spc.nmax</code></td>
<td align="center"><code class="sourceCode r"><span class="dv">10</span></code></td>
<td></td>
<td><code class="sourceCode r"><span class="kw">qplotspc</span>()</code></td>
</tr>
</tbody>
</table>
<!-- ----------------------------------------------------------------------- -->
</div>
<div id="appendix-3--reporting-bugs-and-getting-help" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#appendix-3--reporting-bugs-and-getting-help" class="anchor"></a>Appendix 3. Reporting Bugs and Getting Help</h1>
<div id="reporting-an-issue" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting-an-issue" class="anchor"></a><span class="header-section-number">8.7</span> Reporting an issue</h2>
<p><code>R</code> packages include contact information of the package maintainer, which you can access e.g., by:</p>
<div class="sourceCode" id="cb148"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/maintainer.html">maintainer</a></span>(<span class="st">"hyperSpec"</span>)
<span class="co">#&gt; [1] "Claudia Beleites &lt;Claudia.Beleites@chemometrix.gmbh&gt;"</span>
</pre></div>
<p>In case you want to report an issue, <code>R</code> provides a function to do so:
<code class="sourceCode r"><span class="kw">bug.report</span>()</code> will either open an e-mail to the package maintainer or the issue tracker URL given in the package <code>DESCRIPTION</code>.</p>
<div class="sourceCode" id="cb149"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/bug.report.html">bug.report</a></span>(package = <span class="st">"hyperSpec"</span>)
</pre></div>
<p>Will take you to package <strong>hyperSpec</strong>’s issue tracking page at <a href="https://github.com/cbeleites/hyperSpec/issues" class="uri">https://github.com/cbeleites/hyperSpec/issues</a>.
It also displays essential information about your installation which can help in tracking down the bug.
You can also make suggestions in this manner.</p>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a><span class="header-section-number">8.8</span> Getting Help</h2>
<p>This section needs to be written.</p>
</div>
</div>
<div id="sec:speed-considerations" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#sec:speed-considerations" class="anchor"></a>Appendix 4. Speed and Memory Considerations</h1>
<p>While most of package <strong>hyperSpec</strong>’s functions work at a decent speed for interactive sessions (of course depending on the size of the object), iterated (repeated) calculations as for bootstrapping or iterated cross validation may ask for special speed considerations.</p>
<p>As an example, consider the code for shifting the spectra:</p>
<div class="sourceCode" id="cb150"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">50</span>]
<span class="kw">shifts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">tmp</span>))
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({
  <span class="co">for</span> (<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">tmp</span>))) {
    <span class="kw">tmp</span>[[<span class="kw">i</span>]] <span class="op">&lt;-</span> <span class="fu">interpolate</span>(<span class="kw">tmp</span>[[<span class="kw">i</span>]], <span class="kw">shifts</span>[<span class="kw">i</span>], wl = <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>))
  }
})
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.048   0.002   0.049</span>
</pre></div>
<p>Calculations that involve a lot of subsetting (i.e., extracting or changing the spectra matrix or extra data) can be sped up considerably if the required parts of the <code class="sourceCode r">hyperSpec</code> object are extracted beforehand.
This is somewhat similar to model fitting in <code>R</code> in general: many model fitting functions in <code>R</code> are much faster if the formula interface is avoided and the appropriate <code class="sourceCode r">data.frame</code>s or matrices are handed over directly.</p>
<div class="sourceCode" id="cb151"><pre class="downlit">
<span class="kw">tmp</span> <span class="op">&lt;-</span> <span class="kw">chondro</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">50</span>]
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>({
  <span class="kw">tmp.matrix</span> <span class="op">&lt;-</span> <span class="kw">tmp</span>[[]]
  <span class="kw">wl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">tmp</span>)
  <span class="co">for</span> (<span class="kw">i</span> <span class="co">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">tmp</span>))) {
    <span class="kw">tmp.matrix</span>[<span class="kw">i</span>, ] <span class="op">&lt;-</span> <span class="fu">interpolate</span>(<span class="kw">tmp.matrix</span>[<span class="kw">i</span>, ], <span class="kw">shifts</span>[<span class="kw">i</span>], wl = <span class="kw">wl</span>)
  }
  <span class="kw">tmp</span>[[]] <span class="op">&lt;-</span> <span class="kw">tmp.matrix</span>
})
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   0.010   0.000   0.009</span>
</pre></div>
<!--
## Additional packages


Package **matrixStats** implements fast functions to calculate summary statistics for each row  or each column of a matrix.
This functionality can be enabled for package **hyperSpec** by installing package package **hyperSpec.matrixStats** which is available in package **hyperSpec**'s development repository at <http://hyperSpec.r-forge.r-project.org/>


## Compiled code

R provides interfaces to Fortran and C code, see the manual "Writing `R` Extensions" package **Rcpp**[@Rcpp] allows to conveniently integrate C++ code.
Package **inline**[@inline] adds another layer of convenience: inline definition of functions in C, C++, or Fortran.

An intermediate level is byte compilation of `R` code, which is done by package **compiler**[@compiler].

## Memory usage -->
<p>In general, it is not recommended to work with variables that are more than approximately a third of the available RAM in size. Particularly the import of raw spectroscopic data can consume large amounts of memory.
At certain points, package <strong>hyperSpec</strong> provides switches that allow working with data sets that are actually close to this memory limit.</p>

<p>
The initialization method <code class="sourceCode r"><span class="kw">new</span>(<span class="st">"hyperSpec"</span>, ...)</code> takes particular care to avoid unneccessary copies of the spectra matrix.
In addition, frequent calls to <code class="sourceCode r"><span class="kw">gc</span>()</code> can be requested by <code class="sourceCode r"><span class="kw">hy.setOption</span>(<span class="dt">gc =</span> <span class="ot">TRUE</span>)</code>.
The same behaviour is triggered in <code class="sourceCode r"><span class="kw">read.ENVI</span>()</code> and its derivatives (<code class="sourceCode r"><span class="kw">read.ENVI</span>()</code>, <code class="sourceCode r"><span class="kw">read.ENVI.HySpex</span>()</code>, and <code class="sourceCode r"><span class="kw">read.ENVI.Nicolet</span>()</code>).
The memory consumption of <code class="sourceCode r"><span class="kw">read.txt.Renishaw</span>()</code> can be lowered by importing the data in chunks (argument <code class="sourceCode r">nlines</code>).</p>
</div>
<div id="appendix-5--remarks-on-r-or-how-hyperspec-works-under-the-hood" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#appendix-5--remarks-on-r-or-how-hyperspec-works-under-the-hood" class="anchor"></a>Appendix 5. Remarks on R, or How <strong><em>hyperSpec</em></strong> Works Under the Hood</h1>
<p><code class="sourceCode r">hyperSpec</code> objects are defined using an S4 class. Much of <strong>hyperSpec</strong> is devoted to manipulating these objects using the methods instrinsic to <code>R</code>.</p>
<div id="generic-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#generic-functions" class="anchor"></a><span class="header-section-number">8.9</span> Generic Functions</h2>
<p> <em>Generic Functions</em> are functions that apply to a wide range of data types or classes, e.g., <code class="sourceCode r"><span class="kw">plot</span>()</code>, <code class="sourceCode r"><span class="kw">print</span>()</code>, mathematical operators, etc. These functions can be implemented in a specialized way by each class.
Package <strong>hyperSpec</strong> implements a variety of such functions, see Table <a href="#tab:functions">8.1</a>.</p>
</div>
<div id="functionality-can-be-extended-at-runtime" class="section level2">
<h2 class="hasAnchor">
<a href="#functionality-can-be-extended-at-runtime" class="anchor"></a><span class="header-section-number">8.10</span> Functionality Can be Extended at Runtime</h2>
<p><code>R</code>’s concept of functions offers much flexibility.
Functions may be added or changed by the user in his <em>workspace</em> at any time.
This is also true for methods belonging to a certain class.
Neither restart of <code>R</code> nor reloading of the package or anything the like is needed.
If the original function resides in a namespace (as it is the case for all functions in package <strong>hyperSpec</strong>), the original function is not deleted.
It is just masked by the user’s new function but stays accessible via the <code class="sourceCode r"><span class="op">::</span></code> operator.</p>
<p>The same is true for “normal” variables: you may create changed copies of the example data sets, work with these and then “reset” to package <strong>hyperSpec</strong>’s version of the data set by removing the object in your workspace.</p>
<p>This offers the opportunity of easily writing specialized functions that are adapted to specific
tasks.
Package <strong>hyperSpec</strong>’s vignettes use this to set up special versions of the lattice graphics functions that are already wrapped in <code class="sourceCode r"><span class="kw">print</span>()</code> (see also <a href="http://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-do-lattice_002ftrellis-graphics-not-work_003f">R FAQ: Why do lattice/trellis graphics not work?</a>) and allow the code in the code chunks of the vignettes to be exactly what one would type during an interactive <code>R</code> session.
For the code, check the <code>vignettes.defs</code> file accompanying all package <strong>hyperSpec</strong> vignettes.</p>
</div>
<div id="validity-checking" class="section level2">
<h2 class="hasAnchor">
<a href="#validity-checking" class="anchor"></a><span class="header-section-number">8.11</span> Validity Checking</h2>
<p>S4 classes have a mechanism to define and enforce that the data actually stored in the object is appropriate for this class.
In other words, there is a mechanism of  <em>validity checking</em>.</p>
<p>The functions provided by package <strong>hyperSpec</strong> check the validity of <code class="sourceCode r">hyperSpec</code> objects at the beginning, and – if the validity could be broken by inappropriate arguments – also before leaving the function.


</p>
<p>It is highly recommended to use validity checking also for user-defined functions.
In addition, non-generic functions should first ensure that the argument actually is a <code class="sourceCode r">hyperSpec</code> object.
The two tasks are accomplished by:</p>
<div class="sourceCode" id="cb152"><pre class="downlit">
<span class="fu"><a href="../reference/chk.hy.html">chk.hy</a></span>(<span class="kw">object</span>)
<span class="fu"><a href="../reference/chk.hy.html">validObject</a></span>(<span class="kw">object</span>)
</pre></div>
<p>The first line checks whether <code class="sourceCode r">object</code> is a <code class="sourceCode r">hyperSpec</code> object, the second checks its validity.
Both functions return <code class="sourceCode r"><span class="ot">TRUE</span></code> if the checks succeed, otherwise they raise an error and stop.</p>
</div>
<div id="sec:spec-funct-names" class="section level2">
<h2 class="hasAnchor">
<a href="#sec:spec-funct-names" class="anchor"></a><span class="header-section-number">8.12</span> Special Function Names</h2>
<div id="sec:names-operators" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:names-operators" class="anchor"></a><span class="header-section-number">8.12.1</span> The Names of Operators</h3>
<p>Operators such as <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>,<code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></code>, etc. are, in fact, functions in <code>R</code>.
Thus they can be handed over as arguments to other functions (particularly to the vectorization functions <code class="sourceCode r"><span class="op">*</span><span class="kw">apply</span>()</code>, <code class="sourceCode r"><span class="kw">sweep</span>()</code>, etc.).
In this case, the name of the function must be quoted: `-` is the recommended style (although <code>"-"</code> will often work as well), e.g.,:</p>
<div class="sourceCode" id="cb153"><pre class="downlit">
<span class="fu"><a href="../reference/sweep.html">sweep</a></span>(<span class="kw">flu</span>, <span class="fl">2</span>, <span class="kw">mean</span>, <span class="kw">`-`</span>)
</pre></div>
<p>These functions can also be called in a more function-like style (prefix notation):</p>
<div class="sourceCode" id="cb154"><pre class="downlit">
<span class="fu">`+`</span>(<span class="fl">3</span>, <span class="fl">5</span>)
<span class="co">#&gt; [1] 8</span>
</pre></div>
</div>
<div id="sec:assignment-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#sec:assignment-functions" class="anchor"></a><span class="header-section-number">8.12.2</span> Assignment Functions</h3>
<p>

<code>R</code> allows the definition of functions that do an assignment (set some part of the object), such as:</p>
<div class="sourceCode" id="cb155"><pre class="downlit">
<span class="fu"><a href="../reference/wl.html">wl</a></span>(<span class="kw">flu</span>) <span class="op">&lt;-</span> <span class="kw">new.wavelength.values</span>
</pre></div>
<p>The actual name of the function is <code>wl&lt;-</code> and must be quoted in order to avoid confusion with an assignment to variable <code>wl</code>:</p>
<div class="sourceCode" id="cb156"><pre class="downlit">
<span class="kw">`wl&lt;-`</span>
</pre></div>
<p>Session Info {-}</p>
<div class="sourceCode" id="cb157"><pre class="downlit">
<span class="kw">sessioninfo</span>::<span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span>(<span class="st">"hyperSpec"</span>)
<span class="co">#&gt; ─ Session info ───────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  setting  value                       </span>
<span class="co">#&gt;  version  R version 4.0.2 (2020-06-22)</span>
<span class="co">#&gt;  os       macOS Catalina 10.15.5      </span>
<span class="co">#&gt;  system   x86_64, darwin17.0          </span>
<span class="co">#&gt;  ui       X11                         </span>
<span class="co">#&gt;  language (EN)                        </span>
<span class="co">#&gt;  collate  en_US.UTF-8                 </span>
<span class="co">#&gt;  ctype    en_US.UTF-8                 </span>
<span class="co">#&gt;  tz       UTC                         </span>
<span class="co">#&gt;  date     2020-07-09                  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ─ Packages ───────────────────────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  package      * version       date       lib source        </span>
<span class="co">#&gt;  assertthat     0.2.1         2019-03-21 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  backports      1.1.8         2020-06-17 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  callr          3.4.3         2020-03-28 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  cli            2.0.2         2020-02-28 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  colorspace     1.4-1         2019-03-18 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  crayon         1.3.4         2017-09-16 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  desc           1.2.0         2018-05-01 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  digest         0.6.25        2020-02-23 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  dplyr          1.0.0         2020-05-29 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  ellipsis       0.3.1         2020-05-15 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  evaluate       0.14          2019-05-28 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  fansi          0.4.1         2020-01-08 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  farver         2.0.3         2020-01-16 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  generics       0.0.2         2018-11-29 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  ggplot2      * 3.3.2         2020-06-19 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  glue           1.4.1         2020-05-13 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  gtable         0.3.0         2019-03-25 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  hyperSpec    * 0.99-20200615 2020-07-09 [1] local         </span>
<span class="co">#&gt;  isoband        0.2.2         2020-06-20 [1] CRAN (R 4.0.1)</span>
<span class="co">#&gt;  jpeg           0.1-8.1       2019-10-24 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  labeling       0.3           2014-08-23 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  lattice      * 0.20-41       2020-04-02 [2] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  latticeExtra   0.6-29        2019-12-19 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  lazyeval       0.2.2         2019-03-15 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  lifecycle      0.2.0         2020-03-06 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  magrittr       1.5           2014-11-22 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  MASS         * 7.3-51.6      2020-04-26 [2] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  Matrix         1.2-18        2019-11-27 [2] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  mgcv           1.8-31        2019-11-09 [2] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  munsell        0.5.0         2018-06-12 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  nlme           3.1-148       2020-05-24 [2] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  pillar         1.4.4         2020-05-05 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  pkgbuild       1.0.8         2020-05-07 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  pkgconfig      2.0.3         2019-09-22 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  pkgload        1.1.0         2020-05-29 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  png            0.1-7         2013-12-03 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  praise         1.0.0         2015-08-11 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  prettyunits    1.1.1         2020-01-24 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  processx       3.4.3         2020-07-05 [1] CRAN (R 4.0.2)</span>
<span class="co">#&gt;  ps             1.3.3         2020-05-08 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  purrr          0.3.4         2020-04-17 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  R6             2.4.1         2019-11-12 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  RColorBrewer   1.1-2         2014-12-07 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  rlang          0.4.6         2020-05-02 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  rprojroot      1.3-2         2018-01-03 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  rstudioapi     0.11          2020-02-07 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  scales         1.1.1         2020-05-11 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  testthat       2.3.2         2020-03-02 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  tibble         3.0.2         2020-07-07 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  tidyselect     1.1.0         2020-05-11 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  utf8           1.1.4         2018-05-24 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  vctrs          0.3.1         2020-06-05 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  viridisLite    0.3.0         2018-02-01 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  withr          2.2.0         2020-04-20 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt;  xml2         * 1.3.2         2020-04-23 [1] CRAN (R 4.0.0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] /Users/runner/work/_temp/Library</span>
<span class="co">#&gt; [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</span>
</pre></div>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-mvtnorm">
<p>[1] A. Genz, F. Bretz, T. Miwa, X. Mi, T. Hothorn, Mvtnorm: Multivariate normal and t distributions, 2020. <a href="https://CRAN.R-project.org/package=mvtnorm">https://CRAN.R-project.org/package=mvtnorm</a>.</p>
</div>
<div id="ref-baseline">
<p>[2] K.H. Liland, B.-H. Mevik, Baseline: Baseline correction of spectra, 2020. <a href="https://CRAN.R-project.org/package=baseline">https://CRAN.R-project.org/package=baseline</a>.</p>
</div>
<div id="ref-pls">
<p>[3] B.-H. Mevik, R. Wehrens, K.H. Liland, Pls: Partial least squares and principal component regression, 2019. <a href="https://CRAN.R-project.org/package=pls">https://CRAN.R-project.org/package=pls</a>.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Formulas are combined to a list by <code class="sourceCode r"><span class="kw">c</span>()</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Function <code class="sourceCode r"><span class="kw">sweep</span>()</code> cannot be used here, and while there is the possibility to use sapply or mapply, they are not faster than the for loop in this case. Make sure to work on a copy of the spectra matrix, as that is much faster than row-wise extracting and changing the spectra by <code class="sourceCode r">[[()</code> and <code class="sourceCode r">[[&lt;-</code>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Claudia Beleites, Valter Sergo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
